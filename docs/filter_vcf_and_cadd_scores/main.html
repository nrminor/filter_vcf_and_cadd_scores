<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>filter_vcf_and_cadd_scores.main API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>


            <h2>Contents</h2>
            <ul>
  <li><a href="#downsample-a-multi-sample-vcf-and-associated-cadd-scores">DOWNSAMPLE A MULTI-SAMPLE VCF AND ASSOCIATED CADD SCORES</a></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#NewFile">NewFile</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#NewFile.__init__">NewFile</a>
                        </li>
                        <li>
                                <a class="variable" href="#NewFile.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#NewFile.path">path</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ConfigParams">ConfigParams</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ConfigParams.__init__">ConfigParams</a>
                        </li>
                        <li>
                                <a class="variable" href="#ConfigParams.pos">pos</a>
                        </li>
                        <li>
                                <a class="variable" href="#ConfigParams.chrom">chrom</a>
                        </li>
                        <li>
                                <a class="variable" href="#ConfigParams.skip">skip</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#parse_command_line_args">parse_command_line_args</a>
            </li>
            <li>
                    <a class="function" href="#parse_configurations">parse_configurations</a>
            </li>
            <li>
                    <a class="function" href="#unify_sample_names">unify_sample_names</a>
            </li>
            <li>
                    <a class="function" href="#filter_vcf_samples">filter_vcf_samples</a>
            </li>
            <li>
                    <a class="function" href="#collect_filtered_positions">collect_filtered_positions</a>
            </li>
            <li>
                    <a class="function" href="#main">main</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
filter_vcf_and_cadd_scores<wbr>.main    </h1>

                        <div class="docstring"><h2 id="downsample-a-multi-sample-vcf-and-associated-cadd-scores">DOWNSAMPLE A MULTI-SAMPLE VCF AND ASSOCIATED CADD SCORES</h2>
</div>

                        <input id="mod-main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-main-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">DOWNSAMPLE A MULTI-SAMPLE VCF AND ASSOCIATED CADD SCORES</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">--------------------------------------------------------</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">import</span> <span class="nn">argparse</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">import</span> <span class="nn">glob</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span> <span class="nn">gzip</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">cast</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="kn">import</span> <span class="nn">inspect</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="kn">from</span> <span class="nn">result</span> <span class="kn">import</span> <span class="n">Result</span><span class="p">,</span> <span class="n">Ok</span><span class="p">,</span> <span class="n">Err</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">from</span> <span class="nn">path</span> <span class="kn">import</span> <span class="n">Path</span> <span class="c1"># type: ignore</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">import</span> <span class="nn">polars</span> <span class="k">as</span> <span class="nn">pl</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span> <span class="nn">icecream</span> <span class="kn">import</span> <span class="n">ic</span> <span class="c1"># type: ignore</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">from</span> <span class="nn">strictyaml</span> <span class="kn">import</span> <span class="n">load</span><span class="p">,</span> <span class="n">Map</span><span class="p">,</span> <span class="n">Str</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span> <span class="n">YAMLError</span> <span class="c1"># type: ignore</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="nd">@dataclass</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="k">class</span> <span class="nc">NewFile</span><span class="p">:</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">    A data class for returning a new file path resulting from a successful</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">    subprocess run.</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="nd">@dataclass</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="k">class</span> <span class="nc">ConfigParams</span><span class="p">:</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">    The available config parameters provided in YAML format to this module are</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">    converted into this dataclass for easier access downstream and more strict</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">    typing of each field.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>    <span class="n">pos</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="n">chrom</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>    <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="k">def</span> <span class="nf">parse_command_line_args</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">[</span><span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    Parses command line arguments.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">    Returns:</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">        Result[argparse.Namespace, str]: Returns Ok(argparse.Namespace) if args could</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">        be parsed, else returns Err(str).</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="s2">&quot;--vcf&quot;</span><span class="p">,</span> <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Multisample VCF to subset.&quot;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="p">)</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="s2">&quot;--cadd_table&quot;</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="s2">&quot;-t&quot;</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;CADD Score spreadsheet in TSV format.&quot;</span><span class="p">,</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>    <span class="p">)</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>        <span class="s2">&quot;--animal_file&quot;</span><span class="p">,</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="s2">&quot;-a&quot;</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Text file with one animal name per line.&quot;</span><span class="p">,</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>    <span class="p">)</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>        <span class="s2">&quot;--label&quot;</span><span class="p">,</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="s2">&quot;-l&quot;</span><span class="p">,</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A label for the data you are running on.&quot;</span><span class="p">,</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>    <span class="p">)</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;config.yaml&quot;</span><span class="p">,</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;YAML file used to configure module such that it avoids harcoding.&quot;</span><span class="p">,</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="p">)</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Whether to print logging information at runtime.&quot;</span><span class="p">,</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>    <span class="p">)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>    <span class="k">return</span> <span class="n">Ok</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="k">def</span> <span class="nf">parse_configurations</span><span class="p">(</span><span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">[</span><span class="n">ConfigParams</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">        This module uses the library `strictYAML` to perform very strict, statically</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">        typed configuration. This helps catch errors downstream while also doing away with</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="sd">        most hardcoding, which is likely to cause runtime errors for other users. Like</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">        the other functions in this module, it uses Rust-like result types to handle</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">        potential errors and pass them &quot;up&quot; to the main function.</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">    Args:</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a><span class="sd">        `config_path: str`: A simple file path to a YAML-formatted config file in string</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">        format.</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="sd">    Returns:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">        `Result[ConfigParams, str]`: A result-type containing either an instance of the</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">        dataclass `ConfigParams` or an error message in string format.</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="c1"># define the statically typed schema for the config parameters</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>    <span class="n">schema</span> <span class="o">=</span> <span class="n">Map</span><span class="p">({</span><span class="s2">&quot;cadd_pos_col&quot;</span><span class="p">:</span> <span class="n">Str</span><span class="p">(),</span> <span class="s2">&quot;cadd_chrom_col&quot;</span><span class="p">:</span> <span class="n">Str</span><span class="p">(),</span> <span class="s2">&quot;cadd_skip&quot;</span><span class="p">:</span> <span class="n">Int</span><span class="p">()})</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>    <span class="c1"># use the schema and the provided path to parse out a dictionary of parameters</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="n">config_dict</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>            <span class="nb">dict</span><span class="p">,</span> <span class="n">load</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span><span class="o">.</span><span class="n">bytes</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">),</span> <span class="n">schema</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="p">)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>    <span class="k">except</span> <span class="n">YAMLError</span> <span class="k">as</span> <span class="n">message</span><span class="p">:</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The provided YAML file could not be parsed:</span><span class="se">\n</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>    <span class="n">params</span> <span class="o">=</span> <span class="n">ConfigParams</span><span class="p">(</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="n">pos</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cadd_pos_col&quot;</span><span class="p">)),</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>        <span class="n">chrom</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cadd_chrom_col&quot;</span><span class="p">)),</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="n">skip</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cadd_skip&quot;</span><span class="p">)),</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>    <span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>    <span class="k">return</span> <span class="n">Ok</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="k">def</span> <span class="nf">_list_matched_samples</span><span class="p">(</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>    <span class="n">vcf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">animals</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">        This helper function uses string matching to cross-reference the sample IDs</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">        between a VCF and associated metadata for those samples. It can handle</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">        both gzip-compressed and uncompressed VCFs, though note that it uses file</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">        extensions and note the file contents itself to identify how the file should</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">        be handled.</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">    Args:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">        `vcf_path: str`: A string representing the file path to the VCF to be read.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">        `animals: pl.DataFrame`: A Polars dataframe of animal IDs</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">    Returns:</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">        `Result[List[Tuple[str, str]], str]`: A result type containing either a list of</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">        tuples, each representing the paired metadata and VCF sample IDs, or an error</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">        message string that can be returned as a value without crashing the whole</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">        program.</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>    <span class="c1"># create a list of sample names from the VCF</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>    <span class="n">vcf_samples</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>    <span class="k">if</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.gz&quot;</span><span class="p">):</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">vcf_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">compressed_vcf</span><span class="p">:</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>            <span class="k">for</span> <span class="n">binary_line</span> <span class="ow">in</span> <span class="n">compressed_vcf</span><span class="p">:</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>                <span class="k">if</span> <span class="n">binary_line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;#CHROM&quot;</span><span class="p">):</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>                    <span class="c1"># Split the line by tabs, and extract the sample IDs</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>                    <span class="c1"># starting from the 9th column (0-indexed)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>                    <span class="n">vcf_samples</span> <span class="o">=</span> <span class="n">binary_line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">9</span><span class="p">:]</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>                    <span class="k">break</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>    <span class="k">elif</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.vcf&quot;</span><span class="p">):</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">vcf_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">uncompressed_vcf</span><span class="p">:</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">uncompressed_vcf</span><span class="p">:</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#CHROM&quot;</span><span class="p">):</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>                    <span class="c1"># Split the line by tabs, and extract the sample IDs</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>                    <span class="c1"># starting from the 9th column (0-indexed)</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>                    <span class="n">vcf_samples</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">9</span><span class="p">:]</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>                    <span class="k">break</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vcf_samples</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span><span class="s2">&quot;Failed to define any sample names in the provided VCF.&quot;</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>    <span class="k">assert</span> <span class="p">(</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="s2">&quot;Sample ID&quot;</span> <span class="ow">in</span> <span class="n">animals</span><span class="o">.</span><span class="n">columns</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>    <span class="p">),</span> <span class="s2">&quot;Expected column named &#39;Sample ID&#39; not found in provided table of animal IDs.&quot;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>    <span class="c1"># create a list of the sample names from the metadata</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>    <span class="n">meta_samples</span> <span class="o">=</span> <span class="n">animals</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Sample ID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_nulls</span><span class="p">()</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>    <span class="c1"># make sure the animal IDs are the same types</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="nb">isinstance</span><span class="p">(</span><span class="n">meta_sample</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vcf_sample</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="k">for</span> <span class="n">meta_sample</span><span class="p">,</span> <span class="n">vcf_sample</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">meta_samples</span><span class="p">,</span> <span class="n">vcf_samples</span><span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>    <span class="p">):</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="n">meta_samples</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">meta_samples</span><span class="p">]</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="n">vcf_samples</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">vcf_samples</span><span class="p">]</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>    <span class="c1"># match the two lists, permitting no samples to be unmatched</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>    <span class="n">matched_sample_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>    <span class="k">for</span> <span class="n">meta_sample</span> <span class="ow">in</span> <span class="n">meta_samples</span><span class="p">:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="k">for</span> <span class="n">vcf_sample</span> <span class="ow">in</span> <span class="n">vcf_samples</span><span class="p">:</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>            <span class="k">if</span> <span class="n">meta_sample</span> <span class="ow">in</span> <span class="n">vcf_sample</span><span class="p">:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>                <span class="n">matched_sample_ids</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">vcf_sample</span><span class="p">,</span> <span class="n">meta_sample</span><span class="p">))</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>                <span class="k">break</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matched_sample_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span><span class="s2">&quot;Failed to match sample IDs between VCF and provided animal names&quot;</span><span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>    <span class="k">return</span> <span class="n">Ok</span><span class="p">(</span><span class="n">matched_sample_ids</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="k">def</span> <span class="nf">unify_sample_names</span><span class="p">(</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>    <span class="n">animals</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">vcf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">[</span><span class="n">NewFile</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">        This function double checks the VCF at the provided path to make</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">        sure the sample names in the VCF are the same as the sample names</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">        in the metadata. If they aren&#39;t, it looks for the metadata sample</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">        names as substrings of the VCF sample names. If all metadata</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">        sample names are in fact substrings of the VCF sample names, it</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">        creates a tab-delimited text file to guide BCFTools, which it</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        uses in a subprocess to rename VCF sample names.</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">    Args:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">        animals: A Polars DataFrame of the sample IDs.</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">        vcf_path: a character string filepath leading to the input VCF.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">    Returns:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">        Result[NewFile, str]: A Result containing either an instance of the</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">        NewFile dataclass, which contains the  file path to the new VCF output</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">        by VCFtools, or an informative error message.</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.vcf.gz&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.vcf&quot;</span><span class="p">):</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>            <span class="s2">&quot;VCF is not in a recognizable format. Please double </span><span class="se">\</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="s2">                    check that your VCF file is either gzip-compressed and </span><span class="se">\</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="s2">                    ends with &#39;.vcf.gz&#39;, or is uncompressed and ends with </span><span class="se">\</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="s2">                    &#39;.vcf&#39;.&quot;</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>        <span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>    <span class="n">match_results</span> <span class="o">=</span> <span class="n">_list_matched_samples</span><span class="p">(</span><span class="n">vcf_path</span><span class="p">,</span> <span class="n">animals</span><span class="p">)</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    <span class="k">match</span> <span class="n">match_results</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>        <span class="k">case</span> <span class="n">Ok</span><span class="p">(</span><span class="n">matched_sample_ids</span><span class="p">):</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>            <span class="k">pass</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>        <span class="k">case</span> <span class="n">Err</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="k">return</span> <span class="n">Err</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>    <span class="c1"># return the original VCF if the paths are the same</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">matched_sample_ids</span><span class="p">):</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="n">original_vcf</span> <span class="o">=</span> <span class="n">NewFile</span><span class="p">(</span><span class="n">vcf_path</span><span class="p">,</span> <span class="n">vcf_path</span><span class="p">)</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="k">return</span> <span class="n">Ok</span><span class="p">(</span><span class="n">original_vcf</span><span class="p">)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>    <span class="c1"># write a two column text file, where the first column is names</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>    <span class="c1"># in the VCF (old names), and the second column is names in the</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>    <span class="c1"># metadata (new names)</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;new_sample_names.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_handle</span><span class="p">:</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="k">for</span> <span class="n">sample_row</span> <span class="ow">in</span> <span class="n">matched_sample_ids</span><span class="p">:</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sample_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">sample_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">out_handle</span><span class="p">)</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>    <span class="c1"># create the BCFTools command and run it in a subprocess</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>    <span class="n">new_vcf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">_renamed_samples.vcf.gz&quot;</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_vcf</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">vcf_handle</span><span class="p">:</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="n">bcftools_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="p">(</span><span class="s2">&quot;bcftools&quot;</span><span class="p">,</span> <span class="s2">&quot;reheader&quot;</span><span class="p">,</span> <span class="s2">&quot;--samples&quot;</span><span class="p">,</span> <span class="s2">&quot;new_sample_names.txt&quot;</span><span class="p">,</span> <span class="n">vcf_path</span><span class="p">),</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        <span class="n">gzip_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>            <span class="p">[</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">],</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>            <span class="n">stdin</span><span class="o">=</span><span class="n">bcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="n">stdout</span><span class="o">=</span><span class="n">vcf_handle</span><span class="p">,</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>        <span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="c1"># Allow vcftools to receive a SIGPIPE if gzip exits</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="k">if</span> <span class="n">bcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="n">bcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="c1"># Wait for processes to complete and get their exit codes and stderr</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">bcftools_stderr</span> <span class="o">=</span> <span class="n">bcftools_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">gzip_stderr</span> <span class="o">=</span> <span class="n">gzip_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>    <span class="c1"># Get the exit code and give an informative error message if it isn&#39;t 0</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>    <span class="n">bcftools_exit_code</span> <span class="o">=</span> <span class="n">bcftools_process</span><span class="o">.</span><span class="n">returncode</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>    <span class="k">if</span> <span class="n">bcftools_exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="n">bcftools_error</span> <span class="o">=</span> <span class="n">bcftools_stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>            <span class="sa">f</span><span class="s2">&quot;VCF renaming encountered an error with exit code </span><span class="si">{</span><span class="n">bcftools_exit_code</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="s2">                        </span><span class="si">{</span><span class="n">bcftools_error</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>    <span class="n">gzip_exit_code</span> <span class="o">=</span> <span class="n">gzip_process</span><span class="o">.</span><span class="n">returncode</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>    <span class="k">if</span> <span class="n">gzip_exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="n">gzip_error</span> <span class="o">=</span> <span class="n">gzip_stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>            <span class="sa">f</span><span class="s2">&quot;VCF compression encountered an error with exit code </span><span class="si">{</span><span class="n">gzip_exit_code</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="s2">                        </span><span class="si">{</span><span class="n">gzip_error</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="p">)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>    <span class="c1"># clear out temporary sample name file</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;new_sample_names.txt&quot;</span><span class="p">)</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a>    <span class="n">new_file</span> <span class="o">=</span> <span class="n">NewFile</span><span class="p">(</span><span class="n">new_vcf</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">new_vcf</span><span class="p">))</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>    <span class="k">return</span> <span class="n">Ok</span><span class="p">(</span><span class="n">new_file</span><span class="p">)</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="k">def</span> <span class="nf">filter_vcf_samples</span><span class="p">(</span><span class="n">vcf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">animals</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">[</span><span class="n">NewFile</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">        Run VCFTools to filter a VCF based on a text file of sample IDs to keep.</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">    Args:</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">        vcf_path (str): The path to the input VCF file.</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">        animals (str): The path to the text file containing sample IDs to keep.</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">    Returns:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">        Result[NewFile, str]: A Result containing either the new file path to</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">        the filtered filtered VCF, or an informative error message.</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>    <span class="c1"># handle the possibility that the VCF is not named or formatted correctly</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.vcf.gz&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.vcf&quot;</span><span class="p">):</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>            <span class="s2">&quot;VCF is not in a recognizable format. Please double </span><span class="se">\</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="s2">                    check that your VCF file is either gzip-compressed and </span><span class="se">\</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="s2">                    ends with &#39;.vcf.gz&#39;, or is uncompressed and ends with </span><span class="se">\</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="s2">                    &#39;.vcf&#39;.&quot;</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>        <span class="p">)</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>    <span class="c1"># set the VCFtools input format flag based on the VCF file name is now</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>    <span class="c1"># guaranteed to be present thanks to the above error-handling</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>    <span class="k">if</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.vcf.gz&quot;</span><span class="p">):</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="n">input_format</span> <span class="o">=</span> <span class="s2">&quot;--gzvcf&quot;</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="n">input_format</span> <span class="o">=</span> <span class="s2">&quot;--vcf&quot;</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a>    <span class="c1"># construct the VCFTools subprocess command as a list</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a>    <span class="n">vcftools_command</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>        <span class="s2">&quot;vcftools&quot;</span><span class="p">,</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>        <span class="n">input_format</span><span class="p">,</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>        <span class="n">vcf_path</span><span class="p">,</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>        <span class="s2">&quot;--keep&quot;</span><span class="p">,</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>        <span class="n">animals</span><span class="p">,</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="s2">&quot;--recode&quot;</span><span class="p">,</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>        <span class="s2">&quot;--stdout&quot;</span><span class="p">,</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>    <span class="p">]</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>    <span class="c1"># construct the bcftools subprocess command as a list</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>    <span class="n">bcftools_command</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="s2">&quot;bcftools&quot;</span><span class="p">,</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="s2">&quot;view&quot;</span><span class="p">,</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>        <span class="s2">&quot;--min-ac&quot;</span><span class="p">,</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>        <span class="s2">&quot;COUNT(GT!=&#39;0/0&#39; &amp;&amp; GT!=&#39;0|0&#39; &amp;&amp; GT!=&#39;./.&#39;)&gt;0&quot;</span><span class="p">,</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="s2">&quot;--output-type&quot;</span><span class="p">,</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>        <span class="s2">&quot;z&quot;</span><span class="p">,</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>        <span class="s2">&quot;-&quot;</span><span class="p">,</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>    <span class="p">]</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>    <span class="c1"># run commands</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>    <span class="n">new_vcf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">_filtered.vcf.gz&quot;</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_vcf</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">vcf_handle</span><span class="p">:</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>        <span class="n">vcftools_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>            <span class="n">vcftools_command</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>        <span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>        <span class="n">gzip_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>            <span class="p">[</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">],</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>            <span class="n">stdin</span><span class="o">=</span><span class="n">vcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>        <span class="n">bcftools_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>            <span class="n">bcftools_command</span><span class="p">,</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>            <span class="n">stdin</span><span class="o">=</span><span class="n">gzip_process</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>            <span class="n">stdout</span><span class="o">=</span><span class="n">vcf_handle</span><span class="p">,</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="p">)</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="c1"># Allow vcftools to receive a SIGPIPE if gzip exits</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>        <span class="k">if</span> <span class="n">vcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>            <span class="n">vcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="c1"># Allow bcftools to receive a SIGPIPE if gzip exits</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>        <span class="k">if</span> <span class="n">bcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>            <span class="n">bcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>        <span class="c1"># Wait for processes to complete and get their exit codes and stderr</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">vcftools_stderr</span> <span class="o">=</span> <span class="n">vcftools_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">gzip_stderr</span> <span class="o">=</span> <span class="n">gzip_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">bcftools_stderr</span> <span class="o">=</span> <span class="n">bcftools_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>    <span class="c1"># Get the exit code and give an informative error message if it isn&#39;t 0</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="n">vcftools_exit_code</span> <span class="o">=</span> <span class="n">vcftools_process</span><span class="o">.</span><span class="n">returncode</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>    <span class="k">if</span> <span class="n">vcftools_exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="n">vcftools_error</span> <span class="o">=</span> <span class="n">vcftools_stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>            <span class="sa">f</span><span class="s2">&quot;VCF filtering encountered an error with exit code </span><span class="si">{</span><span class="n">vcftools_exit_code</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="s2">                        </span><span class="si">{</span><span class="n">vcftools_error</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>        <span class="p">)</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>    <span class="n">gzip_exit_code</span> <span class="o">=</span> <span class="n">gzip_process</span><span class="o">.</span><span class="n">returncode</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>    <span class="k">if</span> <span class="n">gzip_exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>        <span class="n">gzip_error</span> <span class="o">=</span> <span class="n">gzip_stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>            <span class="sa">f</span><span class="s2">&quot;VCF filtering encountered an error with exit code </span><span class="si">{</span><span class="n">gzip_exit_code</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="s2">                        </span><span class="si">{</span><span class="n">gzip_error</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="p">)</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>    <span class="n">bcftools_exit_code</span> <span class="o">=</span> <span class="n">bcftools_process</span><span class="o">.</span><span class="n">returncode</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>    <span class="k">if</span> <span class="n">bcftools_exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>        <span class="n">bcftools_error</span> <span class="o">=</span> <span class="n">bcftools_stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>            <span class="sa">f</span><span class="s2">&quot;VCF INFO reformatting failed with </span><span class="si">{</span><span class="n">bcftools_exit_code</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="s2">                        </span><span class="si">{</span><span class="n">bcftools_error</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>        <span class="p">)</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>    <span class="c1"># remove VCFtools log files</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.log&quot;</span><span class="p">):</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>    <span class="n">new_file</span> <span class="o">=</span> <span class="n">NewFile</span><span class="p">(</span><span class="n">new_vcf</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">new_vcf</span><span class="p">))</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>    <span class="k">return</span> <span class="n">Ok</span><span class="p">(</span><span class="n">new_file</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="k">def</span> <span class="nf">collect_filtered_positions</span><span class="p">(</span><span class="n">vcf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">[</span><span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">        Use BCFtools to define the positions that are still present in the</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">        filtered VCF. This positions will be cross-referenced downstream</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">        with a table of CADD scores, making it possible to filter a CADD</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">        table without requiring that table to be annotated with sample IDs.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a><span class="sd">    Args:</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="sd">        vcf_path: the path to the VCF to be assessed.</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">    Returns:</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">        Result[pl.LazyFrame, str]: A result containing either a Polars</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="sd">        LazyFrame of the positions, or an informative error message.</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.vcf.gz&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.vcf&quot;</span><span class="p">):</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>            <span class="s2">&quot;VCF is not in a recognizable format. Please double </span><span class="se">\</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="s2">                    check that your VCF file is either gzip-compressed and </span><span class="se">\</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="s2">                    ends with &#39;.vcf.gz&#39;, or is uncompressed and ends with </span><span class="se">\</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="s2">                    &#39;.vcf&#39;.&quot;</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>        <span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>    <span class="c1"># define the command</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;bcftools&quot;</span><span class="p">,</span> <span class="s2">&quot;query&quot;</span><span class="p">,</span> <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;%CHROM</span><span class="se">\t</span><span class="s2">%POS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">vcf_path</span><span class="p">]</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>    <span class="c1"># Run the command and collect the output</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>        <span class="n">command</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>    <span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>    <span class="c1"># Check if the command was unsuccessful</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>    <span class="n">exitcode</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>    <span class="k">if</span> <span class="n">exitcode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>            <span class="sa">f</span><span class="s2">&quot;BCFtools failed to find positions in the provided VCF and</span><span class="se">\</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="s2">                    terminated with exit code </span><span class="si">{</span><span class="n">exitcode</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>        <span class="p">)</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>    <span class="c1"># The stdout contains the positions, one per line</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>    <span class="n">raw_positions</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>    <span class="c1"># unpack the results into chromosomes and positions</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>    <span class="n">chromosomes</span><span class="p">,</span> <span class="n">positions_str</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw_positions</span><span class="p">])</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>    <span class="n">positions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">positions_str</span><span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>    <span class="p">)</span>  <span class="c1"># Convert positions to integers</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>    <span class="c1"># Convert to integers and double check that the list isn&#39;t empty</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>            <span class="s2">&quot;BCFtools encountered a silent error such that the constructed</span><span class="se">\</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a><span class="s2">                    list of positions is empty&quot;</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>        <span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>    <span class="c1"># convert the list to a polars dataframe and return it</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>    <span class="n">position_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">({</span><span class="s2">&quot;Chromosomes&quot;</span><span class="p">:</span> <span class="n">chromosomes</span><span class="p">,</span> <span class="s2">&quot;Positions&quot;</span><span class="p">:</span> <span class="n">positions</span><span class="p">})</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>            <span class="n">pl</span><span class="o">.</span><span class="n">concat_str</span><span class="p">(</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>                <span class="p">[</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Chromosomes&quot;</span><span class="p">),</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Positions&quot;</span><span class="p">),</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>                <span class="p">],</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>                <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Full Position&quot;</span><span class="p">),</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>        <span class="p">)</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Full Position&quot;</span><span class="p">)</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>            <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Full Position&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace_all</span><span class="p">(</span><span class="s2">&quot;chr&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Full Position&quot;</span><span class="p">)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>        <span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>    <span class="p">)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>    <span class="k">return</span> <span class="n">Ok</span><span class="p">(</span><span class="n">position_df</span><span class="p">)</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">    Main handles I/O, coordinates the flow of data through the above functions,</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">    and exposes any errors.</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>    <span class="c1"># collect command line argument result</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>    <span class="n">arg_result</span> <span class="o">=</span> <span class="n">parse_command_line_args</span><span class="p">()</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>    <span class="k">match</span> <span class="n">arg_result</span><span class="p">:</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="k">case</span> <span class="n">Ok</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>            <span class="n">vcf_path</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">vcf</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>            <span class="n">table_path</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">cadd_table</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>            <span class="n">animals</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">animal_file</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">label</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">config</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbose</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>        <span class="k">case</span> <span class="n">Err</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>    <span class="c1"># define configuration parameters</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>    <span class="n">config_result</span> <span class="o">=</span> <span class="n">parse_configurations</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>    <span class="k">match</span> <span class="n">config_result</span><span class="p">:</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>        <span class="k">case</span> <span class="n">Ok</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>            <span class="k">pass</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>        <span class="k">case</span> <span class="n">Err</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>        <span class="n">ic</span><span class="p">()</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Command line arguments successfully parsed.&quot;</span><span class="p">)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>            <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>                <span class="sa">f</span><span class="s2">&quot;Running on the following files provided in the command line with label &#39;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>            <span class="p">)</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>        <span class="p">)</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">vcf_path</span><span class="p">)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">table_path</span><span class="p">)</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>    <span class="c1"># make sure animal names match the sample IDs in the VCF</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>        <span class="n">ic</span><span class="p">()</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>            <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a><span class="sd">                Reading animal names from text file provided via the command line argument </span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a><span class="sd">                `--animal_file`/`-a`.</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>            <span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>        <span class="p">)</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>    <span class="n">animals_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>        <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>            <span class="n">animals</span><span class="p">,</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>            <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>            <span class="n">null_values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>            <span class="n">has_header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>            <span class="n">new_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Sample ID&quot;</span><span class="p">],</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>        <span class="p">)</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">([</span><span class="s2">&quot;Sample ID&quot;</span><span class="p">]))</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>        <span class="o">.</span><span class="n">drop_nulls</span><span class="p">()</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>    <span class="p">)</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        <span class="n">ic</span><span class="p">()</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cross-referencing sample IDs between the VCF and provided animal table:&quot;</span><span class="p">)</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">vcf_path</span><span class="p">)</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>    <span class="n">unify_result</span> <span class="o">=</span> <span class="n">unify_sample_names</span><span class="p">(</span><span class="n">animals_df</span><span class="p">,</span> <span class="n">vcf_path</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>    <span class="k">match</span> <span class="n">unify_result</span><span class="p">:</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>        <span class="k">case</span> <span class="n">Ok</span><span class="p">(</span><span class="n">new_file</span><span class="p">):</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>            <span class="n">renamed_vcf_path</span> <span class="o">=</span> <span class="n">new_file</span><span class="o">.</span><span class="n">path</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>        <span class="k">case</span> <span class="n">Err</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>    <span class="c1"># filter the VCF</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>        <span class="n">ic</span><span class="p">()</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>            <span class="s2">&quot;No errors encountered while matching VCF sample IDs to animal file sample IDs.&quot;</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>        <span class="p">)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>            <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a><span class="sd">                Now that sample IDs are the same across the metadata and the VCF, filter down to</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a><span class="sd">                the desired samples provided in:</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>            <span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>        <span class="p">)</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>    <span class="n">filtering_result</span> <span class="o">=</span> <span class="n">filter_vcf_samples</span><span class="p">(</span><span class="n">renamed_vcf_path</span><span class="p">,</span> <span class="n">animals</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>    <span class="k">match</span> <span class="n">filtering_result</span><span class="p">:</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>        <span class="k">case</span> <span class="n">Ok</span><span class="p">(</span><span class="n">filtered_file</span><span class="p">):</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>            <span class="n">filtered_vcf</span> <span class="o">=</span> <span class="n">filtered_file</span><span class="o">.</span><span class="n">path</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>        <span class="k">case</span> <span class="n">Err</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>    <span class="c1"># define the positions</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VCF sample filtering completed successfully.&quot;</span><span class="p">)</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>        <span class="n">ic</span><span class="p">()</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>            <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a><span class="sd">                With undesired animals removed, collect the remaining chromosomes and positions</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="sd">                with variants in at least one sample.</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>            <span class="p">)</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>        <span class="p">)</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>    <span class="n">position_result</span> <span class="o">=</span> <span class="n">collect_filtered_positions</span><span class="p">(</span><span class="n">filtered_vcf</span><span class="p">)</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>    <span class="k">match</span> <span class="n">position_result</span><span class="p">:</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>        <span class="k">case</span> <span class="n">Ok</span><span class="p">(</span><span class="n">positions</span><span class="p">):</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>            <span class="k">pass</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>        <span class="k">case</span> <span class="n">Err</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>    <span class="c1"># lazily read the CADD Score table and filter its rows to only those</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>    <span class="c1"># that contain a mutation that is present in the newly filtered VCF</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>        <span class="n">ic</span><span class="p">()</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>            <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a><span class="sd">                Read the table of CADD scores provided at the table path below, double check</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a><span class="sd">                that the expected column names are present, and then filter down to the positions</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a><span class="sd">                that remain in the filtered VCF. This will ensure that no variants will remain in</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a><span class="sd">                the CADD Score table that are not present in one of the animals in the filtered VCF.</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>            <span class="p">)</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>        <span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">table_path</span><span class="p">)</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>    <span class="n">cadd_score_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>        <span class="n">table_path</span><span class="p">,</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>        <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>        <span class="n">skip_rows</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">skip</span><span class="p">,</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>        <span class="n">null_values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">],</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>        <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>    <span class="p">)</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>    <span class="k">assert</span> <span class="p">(</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>        <span class="n">params</span><span class="o">.</span><span class="n">pos</span> <span class="ow">in</span> <span class="n">cadd_score_df</span><span class="o">.</span><span class="n">columns</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Position column named &#39;</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">pos</span><span class="si">}</span><span class="s2">&#39; is missing in CADD score file.&quot;</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>    <span class="k">assert</span> <span class="p">(</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>        <span class="n">params</span><span class="o">.</span><span class="n">chrom</span> <span class="ow">in</span> <span class="n">cadd_score_df</span><span class="o">.</span><span class="n">columns</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Chromosome column named &#39;</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">chrom</span><span class="si">}</span><span class="s2">&#39; is missing in CADD score file.&quot;</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>    <span class="n">cadd_score_lazy</span> <span class="o">=</span> <span class="n">cadd_score_df</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>        <span class="n">pl</span><span class="o">.</span><span class="n">concat_str</span><span class="p">(</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>            <span class="p">[</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>                <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Chrom&quot;</span><span class="p">),</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>                <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Pos&quot;</span><span class="p">),</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>            <span class="p">],</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>            <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Full Position&quot;</span><span class="p">),</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>    <span class="p">)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>    <span class="n">positions</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cadd_score_lazy</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;Full Position&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>        <span class="n">pl</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="s2">&quot;Full Position&quot;</span><span class="p">)</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>    <span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">~</span><span class="n">pl</span><span class="o">.</span><span class="n">all_horizontal</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">is_null</span><span class="p">()))</span><span class="o">.</span><span class="n">sink_csv</span><span class="p">(</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">_filtered_cadd_scores.tsv&quot;</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>    <span class="p">)</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering complete!&quot;</span><span class="p">)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>    <span class="n">main</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="NewFile">
                            <input id="NewFile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">NewFile</span>:

                <label class="view-source-button" for="NewFile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NewFile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NewFile-25"><a href="#NewFile-25"><span class="linenos">25</span></a><span class="nd">@dataclass</span>
</span><span id="NewFile-26"><a href="#NewFile-26"><span class="linenos">26</span></a><span class="k">class</span> <span class="nc">NewFile</span><span class="p">:</span>
</span><span id="NewFile-27"><a href="#NewFile-27"><span class="linenos">27</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NewFile-28"><a href="#NewFile-28"><span class="linenos">28</span></a><span class="sd">    A data class for returning a new file path resulting from a successful</span>
</span><span id="NewFile-29"><a href="#NewFile-29"><span class="linenos">29</span></a><span class="sd">    subprocess run.</span>
</span><span id="NewFile-30"><a href="#NewFile-30"><span class="linenos">30</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="NewFile-31"><a href="#NewFile-31"><span class="linenos">31</span></a>
</span><span id="NewFile-32"><a href="#NewFile-32"><span class="linenos">32</span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="NewFile-33"><a href="#NewFile-33"><span class="linenos">33</span></a>    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
</span></pre></div>


            <div class="docstring"><p>A data class for returning a new file path resulting from a successful
subprocess run.</p>
</div>


                            <div id="NewFile.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">NewFile</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#NewFile.__init__"></a>
    
    

                            </div>
                            <div id="NewFile.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#NewFile.name"></a>
    
    

                            </div>
                            <div id="NewFile.path" class="classattr">
                                <div class="attr variable">
            <span class="name">path</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#NewFile.path"></a>
    
    

                            </div>
                </section>
                <section id="ConfigParams">
                            <input id="ConfigParams-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">ConfigParams</span>:

                <label class="view-source-button" for="ConfigParams-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ConfigParams"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ConfigParams-36"><a href="#ConfigParams-36"><span class="linenos">36</span></a><span class="nd">@dataclass</span>
</span><span id="ConfigParams-37"><a href="#ConfigParams-37"><span class="linenos">37</span></a><span class="k">class</span> <span class="nc">ConfigParams</span><span class="p">:</span>
</span><span id="ConfigParams-38"><a href="#ConfigParams-38"><span class="linenos">38</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ConfigParams-39"><a href="#ConfigParams-39"><span class="linenos">39</span></a><span class="sd">    The available config parameters provided in YAML format to this module are</span>
</span><span id="ConfigParams-40"><a href="#ConfigParams-40"><span class="linenos">40</span></a><span class="sd">    converted into this dataclass for easier access downstream and more strict</span>
</span><span id="ConfigParams-41"><a href="#ConfigParams-41"><span class="linenos">41</span></a><span class="sd">    typing of each field.</span>
</span><span id="ConfigParams-42"><a href="#ConfigParams-42"><span class="linenos">42</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ConfigParams-43"><a href="#ConfigParams-43"><span class="linenos">43</span></a>
</span><span id="ConfigParams-44"><a href="#ConfigParams-44"><span class="linenos">44</span></a>    <span class="n">pos</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="ConfigParams-45"><a href="#ConfigParams-45"><span class="linenos">45</span></a>    <span class="n">chrom</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="ConfigParams-46"><a href="#ConfigParams-46"><span class="linenos">46</span></a>    <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span>
</span></pre></div>


            <div class="docstring"><p>The available config parameters provided in YAML format to this module are
converted into this dataclass for easier access downstream and more strict
typing of each field.</p>
</div>


                            <div id="ConfigParams.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">ConfigParams</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pos</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">chrom</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">skip</span><span class="p">:</span> <span class="nb">int</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#ConfigParams.__init__"></a>
    
    

                            </div>
                            <div id="ConfigParams.pos" class="classattr">
                                <div class="attr variable">
            <span class="name">pos</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#ConfigParams.pos"></a>
    
    

                            </div>
                            <div id="ConfigParams.chrom" class="classattr">
                                <div class="attr variable">
            <span class="name">chrom</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#ConfigParams.chrom"></a>
    
    

                            </div>
                            <div id="ConfigParams.skip" class="classattr">
                                <div class="attr variable">
            <span class="name">skip</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#ConfigParams.skip"></a>
    
    

                            </div>
                </section>
                <section id="parse_command_line_args">
                            <input id="parse_command_line_args-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_command_line_args</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">Ok</span><span class="p">[</span><span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">Err</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="parse_command_line_args-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_command_line_args"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_command_line_args-49"><a href="#parse_command_line_args-49"><span class="linenos">49</span></a><span class="k">def</span> <span class="nf">parse_command_line_args</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">[</span><span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="parse_command_line_args-50"><a href="#parse_command_line_args-50"><span class="linenos">50</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="parse_command_line_args-51"><a href="#parse_command_line_args-51"><span class="linenos">51</span></a><span class="sd">    Parses command line arguments.</span>
</span><span id="parse_command_line_args-52"><a href="#parse_command_line_args-52"><span class="linenos">52</span></a>
</span><span id="parse_command_line_args-53"><a href="#parse_command_line_args-53"><span class="linenos">53</span></a><span class="sd">    Returns:</span>
</span><span id="parse_command_line_args-54"><a href="#parse_command_line_args-54"><span class="linenos">54</span></a><span class="sd">        Result[argparse.Namespace, str]: Returns Ok(argparse.Namespace) if args could</span>
</span><span id="parse_command_line_args-55"><a href="#parse_command_line_args-55"><span class="linenos">55</span></a><span class="sd">        be parsed, else returns Err(str).</span>
</span><span id="parse_command_line_args-56"><a href="#parse_command_line_args-56"><span class="linenos">56</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_command_line_args-57"><a href="#parse_command_line_args-57"><span class="linenos">57</span></a>    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span><span id="parse_command_line_args-58"><a href="#parse_command_line_args-58"><span class="linenos">58</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="parse_command_line_args-59"><a href="#parse_command_line_args-59"><span class="linenos">59</span></a>        <span class="s2">&quot;--vcf&quot;</span><span class="p">,</span> <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Multisample VCF to subset.&quot;</span>
</span><span id="parse_command_line_args-60"><a href="#parse_command_line_args-60"><span class="linenos">60</span></a>    <span class="p">)</span>
</span><span id="parse_command_line_args-61"><a href="#parse_command_line_args-61"><span class="linenos">61</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="parse_command_line_args-62"><a href="#parse_command_line_args-62"><span class="linenos">62</span></a>        <span class="s2">&quot;--cadd_table&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-63"><a href="#parse_command_line_args-63"><span class="linenos">63</span></a>        <span class="s2">&quot;-t&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-64"><a href="#parse_command_line_args-64"><span class="linenos">64</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="parse_command_line_args-65"><a href="#parse_command_line_args-65"><span class="linenos">65</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="parse_command_line_args-66"><a href="#parse_command_line_args-66"><span class="linenos">66</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;CADD Score spreadsheet in TSV format.&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-67"><a href="#parse_command_line_args-67"><span class="linenos">67</span></a>    <span class="p">)</span>
</span><span id="parse_command_line_args-68"><a href="#parse_command_line_args-68"><span class="linenos">68</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="parse_command_line_args-69"><a href="#parse_command_line_args-69"><span class="linenos">69</span></a>        <span class="s2">&quot;--animal_file&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-70"><a href="#parse_command_line_args-70"><span class="linenos">70</span></a>        <span class="s2">&quot;-a&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-71"><a href="#parse_command_line_args-71"><span class="linenos">71</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="parse_command_line_args-72"><a href="#parse_command_line_args-72"><span class="linenos">72</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="parse_command_line_args-73"><a href="#parse_command_line_args-73"><span class="linenos">73</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Text file with one animal name per line.&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-74"><a href="#parse_command_line_args-74"><span class="linenos">74</span></a>    <span class="p">)</span>
</span><span id="parse_command_line_args-75"><a href="#parse_command_line_args-75"><span class="linenos">75</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="parse_command_line_args-76"><a href="#parse_command_line_args-76"><span class="linenos">76</span></a>        <span class="s2">&quot;--label&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-77"><a href="#parse_command_line_args-77"><span class="linenos">77</span></a>        <span class="s2">&quot;-l&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-78"><a href="#parse_command_line_args-78"><span class="linenos">78</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="parse_command_line_args-79"><a href="#parse_command_line_args-79"><span class="linenos">79</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="parse_command_line_args-80"><a href="#parse_command_line_args-80"><span class="linenos">80</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;A label for the data you are running on.&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-81"><a href="#parse_command_line_args-81"><span class="linenos">81</span></a>    <span class="p">)</span>
</span><span id="parse_command_line_args-82"><a href="#parse_command_line_args-82"><span class="linenos">82</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="parse_command_line_args-83"><a href="#parse_command_line_args-83"><span class="linenos">83</span></a>        <span class="s2">&quot;--config&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-84"><a href="#parse_command_line_args-84"><span class="linenos">84</span></a>        <span class="s2">&quot;-c&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-85"><a href="#parse_command_line_args-85"><span class="linenos">85</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span id="parse_command_line_args-86"><a href="#parse_command_line_args-86"><span class="linenos">86</span></a>        <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="parse_command_line_args-87"><a href="#parse_command_line_args-87"><span class="linenos">87</span></a>        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;config.yaml&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-88"><a href="#parse_command_line_args-88"><span class="linenos">88</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;YAML file used to configure module such that it avoids harcoding.&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-89"><a href="#parse_command_line_args-89"><span class="linenos">89</span></a>    <span class="p">)</span>
</span><span id="parse_command_line_args-90"><a href="#parse_command_line_args-90"><span class="linenos">90</span></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span><span id="parse_command_line_args-91"><a href="#parse_command_line_args-91"><span class="linenos">91</span></a>        <span class="s2">&quot;--verbose&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-92"><a href="#parse_command_line_args-92"><span class="linenos">92</span></a>        <span class="s2">&quot;-v&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-93"><a href="#parse_command_line_args-93"><span class="linenos">93</span></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">bool</span><span class="p">,</span>
</span><span id="parse_command_line_args-94"><a href="#parse_command_line_args-94"><span class="linenos">94</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="parse_command_line_args-95"><a href="#parse_command_line_args-95"><span class="linenos">95</span></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Whether to print logging information at runtime.&quot;</span><span class="p">,</span>
</span><span id="parse_command_line_args-96"><a href="#parse_command_line_args-96"><span class="linenos">96</span></a>    <span class="p">)</span>
</span><span id="parse_command_line_args-97"><a href="#parse_command_line_args-97"><span class="linenos">97</span></a>    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span><span id="parse_command_line_args-98"><a href="#parse_command_line_args-98"><span class="linenos">98</span></a>
</span><span id="parse_command_line_args-99"><a href="#parse_command_line_args-99"><span class="linenos">99</span></a>    <span class="k">return</span> <span class="n">Ok</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Parses command line arguments.</p>

<p>Returns:
    Result[argparse.Namespace, str]: Returns Ok(argparse.Namespace) if args could
    be parsed, else returns Err(str).</p>
</div>


                </section>
                <section id="parse_configurations">
                            <input id="parse_configurations-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_configurations</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">Ok</span><span class="p">[</span><span class="n"><a href="#ConfigParams">ConfigParams</a></span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">Err</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="parse_configurations-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_configurations"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_configurations-102"><a href="#parse_configurations-102"><span class="linenos">102</span></a><span class="k">def</span> <span class="nf">parse_configurations</span><span class="p">(</span><span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">[</span><span class="n">ConfigParams</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="parse_configurations-103"><a href="#parse_configurations-103"><span class="linenos">103</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="parse_configurations-104"><a href="#parse_configurations-104"><span class="linenos">104</span></a><span class="sd">        This module uses the library `strictYAML` to perform very strict, statically</span>
</span><span id="parse_configurations-105"><a href="#parse_configurations-105"><span class="linenos">105</span></a><span class="sd">        typed configuration. This helps catch errors downstream while also doing away with</span>
</span><span id="parse_configurations-106"><a href="#parse_configurations-106"><span class="linenos">106</span></a><span class="sd">        most hardcoding, which is likely to cause runtime errors for other users. Like</span>
</span><span id="parse_configurations-107"><a href="#parse_configurations-107"><span class="linenos">107</span></a><span class="sd">        the other functions in this module, it uses Rust-like result types to handle</span>
</span><span id="parse_configurations-108"><a href="#parse_configurations-108"><span class="linenos">108</span></a><span class="sd">        potential errors and pass them &quot;up&quot; to the main function.</span>
</span><span id="parse_configurations-109"><a href="#parse_configurations-109"><span class="linenos">109</span></a>
</span><span id="parse_configurations-110"><a href="#parse_configurations-110"><span class="linenos">110</span></a><span class="sd">    Args:</span>
</span><span id="parse_configurations-111"><a href="#parse_configurations-111"><span class="linenos">111</span></a><span class="sd">        `config_path: str`: A simple file path to a YAML-formatted config file in string</span>
</span><span id="parse_configurations-112"><a href="#parse_configurations-112"><span class="linenos">112</span></a><span class="sd">        format.</span>
</span><span id="parse_configurations-113"><a href="#parse_configurations-113"><span class="linenos">113</span></a>
</span><span id="parse_configurations-114"><a href="#parse_configurations-114"><span class="linenos">114</span></a><span class="sd">    Returns:</span>
</span><span id="parse_configurations-115"><a href="#parse_configurations-115"><span class="linenos">115</span></a><span class="sd">        `Result[ConfigParams, str]`: A result-type containing either an instance of the</span>
</span><span id="parse_configurations-116"><a href="#parse_configurations-116"><span class="linenos">116</span></a><span class="sd">        dataclass `ConfigParams` or an error message in string format.</span>
</span><span id="parse_configurations-117"><a href="#parse_configurations-117"><span class="linenos">117</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="parse_configurations-118"><a href="#parse_configurations-118"><span class="linenos">118</span></a>
</span><span id="parse_configurations-119"><a href="#parse_configurations-119"><span class="linenos">119</span></a>    <span class="c1"># define the statically typed schema for the config parameters</span>
</span><span id="parse_configurations-120"><a href="#parse_configurations-120"><span class="linenos">120</span></a>    <span class="n">schema</span> <span class="o">=</span> <span class="n">Map</span><span class="p">({</span><span class="s2">&quot;cadd_pos_col&quot;</span><span class="p">:</span> <span class="n">Str</span><span class="p">(),</span> <span class="s2">&quot;cadd_chrom_col&quot;</span><span class="p">:</span> <span class="n">Str</span><span class="p">(),</span> <span class="s2">&quot;cadd_skip&quot;</span><span class="p">:</span> <span class="n">Int</span><span class="p">()})</span>
</span><span id="parse_configurations-121"><a href="#parse_configurations-121"><span class="linenos">121</span></a>
</span><span id="parse_configurations-122"><a href="#parse_configurations-122"><span class="linenos">122</span></a>    <span class="c1"># use the schema and the provided path to parse out a dictionary of parameters</span>
</span><span id="parse_configurations-123"><a href="#parse_configurations-123"><span class="linenos">123</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="parse_configurations-124"><a href="#parse_configurations-124"><span class="linenos">124</span></a>        <span class="n">config_dict</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
</span><span id="parse_configurations-125"><a href="#parse_configurations-125"><span class="linenos">125</span></a>            <span class="nb">dict</span><span class="p">,</span> <span class="n">load</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">config_path</span><span class="p">)</span><span class="o">.</span><span class="n">bytes</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">),</span> <span class="n">schema</span><span class="p">)</span><span class="o">.</span><span class="n">data</span>
</span><span id="parse_configurations-126"><a href="#parse_configurations-126"><span class="linenos">126</span></a>        <span class="p">)</span>
</span><span id="parse_configurations-127"><a href="#parse_configurations-127"><span class="linenos">127</span></a>    <span class="k">except</span> <span class="n">YAMLError</span> <span class="k">as</span> <span class="n">message</span><span class="p">:</span>
</span><span id="parse_configurations-128"><a href="#parse_configurations-128"><span class="linenos">128</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The provided YAML file could not be parsed:</span><span class="se">\n</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="parse_configurations-129"><a href="#parse_configurations-129"><span class="linenos">129</span></a>
</span><span id="parse_configurations-130"><a href="#parse_configurations-130"><span class="linenos">130</span></a>    <span class="n">params</span> <span class="o">=</span> <span class="n">ConfigParams</span><span class="p">(</span>
</span><span id="parse_configurations-131"><a href="#parse_configurations-131"><span class="linenos">131</span></a>        <span class="n">pos</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cadd_pos_col&quot;</span><span class="p">)),</span>
</span><span id="parse_configurations-132"><a href="#parse_configurations-132"><span class="linenos">132</span></a>        <span class="n">chrom</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cadd_chrom_col&quot;</span><span class="p">)),</span>
</span><span id="parse_configurations-133"><a href="#parse_configurations-133"><span class="linenos">133</span></a>        <span class="n">skip</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cadd_skip&quot;</span><span class="p">)),</span>
</span><span id="parse_configurations-134"><a href="#parse_configurations-134"><span class="linenos">134</span></a>    <span class="p">)</span>
</span><span id="parse_configurations-135"><a href="#parse_configurations-135"><span class="linenos">135</span></a>
</span><span id="parse_configurations-136"><a href="#parse_configurations-136"><span class="linenos">136</span></a>    <span class="k">return</span> <span class="n">Ok</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This module uses the library <code>strictYAML</code> to perform very strict, statically
    typed configuration. This helps catch errors downstream while also doing away with
    most hardcoding, which is likely to cause runtime errors for other users. Like
    the other functions in this module, it uses Rust-like result types to handle
    potential errors and pass them "up" to the main function.</p>

<p>Args:
    <code>config_path: str</code>: A simple file path to a YAML-formatted config file in string
    format.</p>

<p>Returns:
    <code>Result[ConfigParams, str]</code>: A result-type containing either an instance of the
    dataclass <code><a href="#ConfigParams">ConfigParams</a></code> or an error message in string format.</p>
</div>


                </section>
                <section id="unify_sample_names">
                            <input id="unify_sample_names-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unify_sample_names</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">animals</span><span class="p">:</span> <span class="n">polars</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>,</span><span class="param">	<span class="n">vcf_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">label</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">Ok</span><span class="p">[</span><span class="n"><a href="#NewFile">NewFile</a></span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">Err</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="unify_sample_names-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#unify_sample_names"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="unify_sample_names-209"><a href="#unify_sample_names-209"><span class="linenos">209</span></a><span class="k">def</span> <span class="nf">unify_sample_names</span><span class="p">(</span>
</span><span id="unify_sample_names-210"><a href="#unify_sample_names-210"><span class="linenos">210</span></a>    <span class="n">animals</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">vcf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="unify_sample_names-211"><a href="#unify_sample_names-211"><span class="linenos">211</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">[</span><span class="n">NewFile</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="unify_sample_names-212"><a href="#unify_sample_names-212"><span class="linenos">212</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="unify_sample_names-213"><a href="#unify_sample_names-213"><span class="linenos">213</span></a><span class="sd">        This function double checks the VCF at the provided path to make</span>
</span><span id="unify_sample_names-214"><a href="#unify_sample_names-214"><span class="linenos">214</span></a><span class="sd">        sure the sample names in the VCF are the same as the sample names</span>
</span><span id="unify_sample_names-215"><a href="#unify_sample_names-215"><span class="linenos">215</span></a><span class="sd">        in the metadata. If they aren&#39;t, it looks for the metadata sample</span>
</span><span id="unify_sample_names-216"><a href="#unify_sample_names-216"><span class="linenos">216</span></a><span class="sd">        names as substrings of the VCF sample names. If all metadata</span>
</span><span id="unify_sample_names-217"><a href="#unify_sample_names-217"><span class="linenos">217</span></a><span class="sd">        sample names are in fact substrings of the VCF sample names, it</span>
</span><span id="unify_sample_names-218"><a href="#unify_sample_names-218"><span class="linenos">218</span></a><span class="sd">        creates a tab-delimited text file to guide BCFTools, which it</span>
</span><span id="unify_sample_names-219"><a href="#unify_sample_names-219"><span class="linenos">219</span></a><span class="sd">        uses in a subprocess to rename VCF sample names.</span>
</span><span id="unify_sample_names-220"><a href="#unify_sample_names-220"><span class="linenos">220</span></a>
</span><span id="unify_sample_names-221"><a href="#unify_sample_names-221"><span class="linenos">221</span></a><span class="sd">    Args:</span>
</span><span id="unify_sample_names-222"><a href="#unify_sample_names-222"><span class="linenos">222</span></a><span class="sd">        animals: A Polars DataFrame of the sample IDs.</span>
</span><span id="unify_sample_names-223"><a href="#unify_sample_names-223"><span class="linenos">223</span></a><span class="sd">        vcf_path: a character string filepath leading to the input VCF.</span>
</span><span id="unify_sample_names-224"><a href="#unify_sample_names-224"><span class="linenos">224</span></a>
</span><span id="unify_sample_names-225"><a href="#unify_sample_names-225"><span class="linenos">225</span></a><span class="sd">    Returns:</span>
</span><span id="unify_sample_names-226"><a href="#unify_sample_names-226"><span class="linenos">226</span></a><span class="sd">        Result[NewFile, str]: A Result containing either an instance of the</span>
</span><span id="unify_sample_names-227"><a href="#unify_sample_names-227"><span class="linenos">227</span></a><span class="sd">        NewFile dataclass, which contains the  file path to the new VCF output</span>
</span><span id="unify_sample_names-228"><a href="#unify_sample_names-228"><span class="linenos">228</span></a><span class="sd">        by VCFtools, or an informative error message.</span>
</span><span id="unify_sample_names-229"><a href="#unify_sample_names-229"><span class="linenos">229</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="unify_sample_names-230"><a href="#unify_sample_names-230"><span class="linenos">230</span></a>
</span><span id="unify_sample_names-231"><a href="#unify_sample_names-231"><span class="linenos">231</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.vcf.gz&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.vcf&quot;</span><span class="p">):</span>
</span><span id="unify_sample_names-232"><a href="#unify_sample_names-232"><span class="linenos">232</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="unify_sample_names-233"><a href="#unify_sample_names-233"><span class="linenos">233</span></a>            <span class="s2">&quot;VCF is not in a recognizable format. Please double </span><span class="se">\</span>
</span><span id="unify_sample_names-234"><a href="#unify_sample_names-234"><span class="linenos">234</span></a><span class="s2">                    check that your VCF file is either gzip-compressed and </span><span class="se">\</span>
</span><span id="unify_sample_names-235"><a href="#unify_sample_names-235"><span class="linenos">235</span></a><span class="s2">                    ends with &#39;.vcf.gz&#39;, or is uncompressed and ends with </span><span class="se">\</span>
</span><span id="unify_sample_names-236"><a href="#unify_sample_names-236"><span class="linenos">236</span></a><span class="s2">                    &#39;.vcf&#39;.&quot;</span>
</span><span id="unify_sample_names-237"><a href="#unify_sample_names-237"><span class="linenos">237</span></a>        <span class="p">)</span>
</span><span id="unify_sample_names-238"><a href="#unify_sample_names-238"><span class="linenos">238</span></a>
</span><span id="unify_sample_names-239"><a href="#unify_sample_names-239"><span class="linenos">239</span></a>    <span class="n">match_results</span> <span class="o">=</span> <span class="n">_list_matched_samples</span><span class="p">(</span><span class="n">vcf_path</span><span class="p">,</span> <span class="n">animals</span><span class="p">)</span>
</span><span id="unify_sample_names-240"><a href="#unify_sample_names-240"><span class="linenos">240</span></a>    <span class="k">match</span> <span class="n">match_results</span><span class="p">:</span>
</span><span id="unify_sample_names-241"><a href="#unify_sample_names-241"><span class="linenos">241</span></a>        <span class="k">case</span> <span class="n">Ok</span><span class="p">(</span><span class="n">matched_sample_ids</span><span class="p">):</span>
</span><span id="unify_sample_names-242"><a href="#unify_sample_names-242"><span class="linenos">242</span></a>            <span class="k">pass</span>
</span><span id="unify_sample_names-243"><a href="#unify_sample_names-243"><span class="linenos">243</span></a>        <span class="k">case</span> <span class="n">Err</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
</span><span id="unify_sample_names-244"><a href="#unify_sample_names-244"><span class="linenos">244</span></a>            <span class="k">return</span> <span class="n">Err</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="unify_sample_names-245"><a href="#unify_sample_names-245"><span class="linenos">245</span></a>
</span><span id="unify_sample_names-246"><a href="#unify_sample_names-246"><span class="linenos">246</span></a>    <span class="c1"># return the original VCF if the paths are the same</span>
</span><span id="unify_sample_names-247"><a href="#unify_sample_names-247"><span class="linenos">247</span></a>    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">matched_sample_ids</span><span class="p">):</span>
</span><span id="unify_sample_names-248"><a href="#unify_sample_names-248"><span class="linenos">248</span></a>        <span class="n">original_vcf</span> <span class="o">=</span> <span class="n">NewFile</span><span class="p">(</span><span class="n">vcf_path</span><span class="p">,</span> <span class="n">vcf_path</span><span class="p">)</span>
</span><span id="unify_sample_names-249"><a href="#unify_sample_names-249"><span class="linenos">249</span></a>        <span class="k">return</span> <span class="n">Ok</span><span class="p">(</span><span class="n">original_vcf</span><span class="p">)</span>
</span><span id="unify_sample_names-250"><a href="#unify_sample_names-250"><span class="linenos">250</span></a>
</span><span id="unify_sample_names-251"><a href="#unify_sample_names-251"><span class="linenos">251</span></a>    <span class="c1"># write a two column text file, where the first column is names</span>
</span><span id="unify_sample_names-252"><a href="#unify_sample_names-252"><span class="linenos">252</span></a>    <span class="c1"># in the VCF (old names), and the second column is names in the</span>
</span><span id="unify_sample_names-253"><a href="#unify_sample_names-253"><span class="linenos">253</span></a>    <span class="c1"># metadata (new names)</span>
</span><span id="unify_sample_names-254"><a href="#unify_sample_names-254"><span class="linenos">254</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;new_sample_names.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_handle</span><span class="p">:</span>
</span><span id="unify_sample_names-255"><a href="#unify_sample_names-255"><span class="linenos">255</span></a>        <span class="k">for</span> <span class="n">sample_row</span> <span class="ow">in</span> <span class="n">matched_sample_ids</span><span class="p">:</span>
</span><span id="unify_sample_names-256"><a href="#unify_sample_names-256"><span class="linenos">256</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sample_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\t</span><span class="si">{</span><span class="n">sample_row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">out_handle</span><span class="p">)</span>
</span><span id="unify_sample_names-257"><a href="#unify_sample_names-257"><span class="linenos">257</span></a>
</span><span id="unify_sample_names-258"><a href="#unify_sample_names-258"><span class="linenos">258</span></a>    <span class="c1"># create the BCFTools command and run it in a subprocess</span>
</span><span id="unify_sample_names-259"><a href="#unify_sample_names-259"><span class="linenos">259</span></a>    <span class="n">new_vcf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">_renamed_samples.vcf.gz&quot;</span>
</span><span id="unify_sample_names-260"><a href="#unify_sample_names-260"><span class="linenos">260</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_vcf</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">vcf_handle</span><span class="p">:</span>
</span><span id="unify_sample_names-261"><a href="#unify_sample_names-261"><span class="linenos">261</span></a>        <span class="n">bcftools_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
</span><span id="unify_sample_names-262"><a href="#unify_sample_names-262"><span class="linenos">262</span></a>            <span class="p">(</span><span class="s2">&quot;bcftools&quot;</span><span class="p">,</span> <span class="s2">&quot;reheader&quot;</span><span class="p">,</span> <span class="s2">&quot;--samples&quot;</span><span class="p">,</span> <span class="s2">&quot;new_sample_names.txt&quot;</span><span class="p">,</span> <span class="n">vcf_path</span><span class="p">),</span>
</span><span id="unify_sample_names-263"><a href="#unify_sample_names-263"><span class="linenos">263</span></a>            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="unify_sample_names-264"><a href="#unify_sample_names-264"><span class="linenos">264</span></a>        <span class="p">)</span>
</span><span id="unify_sample_names-265"><a href="#unify_sample_names-265"><span class="linenos">265</span></a>        <span class="n">gzip_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
</span><span id="unify_sample_names-266"><a href="#unify_sample_names-266"><span class="linenos">266</span></a>            <span class="p">[</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">],</span>
</span><span id="unify_sample_names-267"><a href="#unify_sample_names-267"><span class="linenos">267</span></a>            <span class="n">stdin</span><span class="o">=</span><span class="n">bcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
</span><span id="unify_sample_names-268"><a href="#unify_sample_names-268"><span class="linenos">268</span></a>            <span class="n">stdout</span><span class="o">=</span><span class="n">vcf_handle</span><span class="p">,</span>
</span><span id="unify_sample_names-269"><a href="#unify_sample_names-269"><span class="linenos">269</span></a>            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="unify_sample_names-270"><a href="#unify_sample_names-270"><span class="linenos">270</span></a>        <span class="p">)</span>
</span><span id="unify_sample_names-271"><a href="#unify_sample_names-271"><span class="linenos">271</span></a>
</span><span id="unify_sample_names-272"><a href="#unify_sample_names-272"><span class="linenos">272</span></a>        <span class="c1"># Allow vcftools to receive a SIGPIPE if gzip exits</span>
</span><span id="unify_sample_names-273"><a href="#unify_sample_names-273"><span class="linenos">273</span></a>        <span class="k">if</span> <span class="n">bcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
</span><span id="unify_sample_names-274"><a href="#unify_sample_names-274"><span class="linenos">274</span></a>            <span class="n">bcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="unify_sample_names-275"><a href="#unify_sample_names-275"><span class="linenos">275</span></a>
</span><span id="unify_sample_names-276"><a href="#unify_sample_names-276"><span class="linenos">276</span></a>        <span class="c1"># Wait for processes to complete and get their exit codes and stderr</span>
</span><span id="unify_sample_names-277"><a href="#unify_sample_names-277"><span class="linenos">277</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">bcftools_stderr</span> <span class="o">=</span> <span class="n">bcftools_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</span><span id="unify_sample_names-278"><a href="#unify_sample_names-278"><span class="linenos">278</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">gzip_stderr</span> <span class="o">=</span> <span class="n">gzip_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</span><span id="unify_sample_names-279"><a href="#unify_sample_names-279"><span class="linenos">279</span></a>
</span><span id="unify_sample_names-280"><a href="#unify_sample_names-280"><span class="linenos">280</span></a>    <span class="c1"># Get the exit code and give an informative error message if it isn&#39;t 0</span>
</span><span id="unify_sample_names-281"><a href="#unify_sample_names-281"><span class="linenos">281</span></a>    <span class="n">bcftools_exit_code</span> <span class="o">=</span> <span class="n">bcftools_process</span><span class="o">.</span><span class="n">returncode</span>
</span><span id="unify_sample_names-282"><a href="#unify_sample_names-282"><span class="linenos">282</span></a>    <span class="k">if</span> <span class="n">bcftools_exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="unify_sample_names-283"><a href="#unify_sample_names-283"><span class="linenos">283</span></a>        <span class="n">bcftools_error</span> <span class="o">=</span> <span class="n">bcftools_stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="unify_sample_names-284"><a href="#unify_sample_names-284"><span class="linenos">284</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="unify_sample_names-285"><a href="#unify_sample_names-285"><span class="linenos">285</span></a>            <span class="sa">f</span><span class="s2">&quot;VCF renaming encountered an error with exit code </span><span class="si">{</span><span class="n">bcftools_exit_code</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\</span>
</span><span id="unify_sample_names-286"><a href="#unify_sample_names-286"><span class="linenos">286</span></a><span class="s2">                        </span><span class="si">{</span><span class="n">bcftools_error</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="unify_sample_names-287"><a href="#unify_sample_names-287"><span class="linenos">287</span></a>        <span class="p">)</span>
</span><span id="unify_sample_names-288"><a href="#unify_sample_names-288"><span class="linenos">288</span></a>    <span class="n">gzip_exit_code</span> <span class="o">=</span> <span class="n">gzip_process</span><span class="o">.</span><span class="n">returncode</span>
</span><span id="unify_sample_names-289"><a href="#unify_sample_names-289"><span class="linenos">289</span></a>    <span class="k">if</span> <span class="n">gzip_exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="unify_sample_names-290"><a href="#unify_sample_names-290"><span class="linenos">290</span></a>        <span class="n">gzip_error</span> <span class="o">=</span> <span class="n">gzip_stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="unify_sample_names-291"><a href="#unify_sample_names-291"><span class="linenos">291</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="unify_sample_names-292"><a href="#unify_sample_names-292"><span class="linenos">292</span></a>            <span class="sa">f</span><span class="s2">&quot;VCF compression encountered an error with exit code </span><span class="si">{</span><span class="n">gzip_exit_code</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\</span>
</span><span id="unify_sample_names-293"><a href="#unify_sample_names-293"><span class="linenos">293</span></a><span class="s2">                        </span><span class="si">{</span><span class="n">gzip_error</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="unify_sample_names-294"><a href="#unify_sample_names-294"><span class="linenos">294</span></a>        <span class="p">)</span>
</span><span id="unify_sample_names-295"><a href="#unify_sample_names-295"><span class="linenos">295</span></a>
</span><span id="unify_sample_names-296"><a href="#unify_sample_names-296"><span class="linenos">296</span></a>    <span class="c1"># clear out temporary sample name file</span>
</span><span id="unify_sample_names-297"><a href="#unify_sample_names-297"><span class="linenos">297</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;new_sample_names.txt&quot;</span><span class="p">)</span>
</span><span id="unify_sample_names-298"><a href="#unify_sample_names-298"><span class="linenos">298</span></a>
</span><span id="unify_sample_names-299"><a href="#unify_sample_names-299"><span class="linenos">299</span></a>    <span class="n">new_file</span> <span class="o">=</span> <span class="n">NewFile</span><span class="p">(</span><span class="n">new_vcf</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">new_vcf</span><span class="p">))</span>
</span><span id="unify_sample_names-300"><a href="#unify_sample_names-300"><span class="linenos">300</span></a>
</span><span id="unify_sample_names-301"><a href="#unify_sample_names-301"><span class="linenos">301</span></a>    <span class="k">return</span> <span class="n">Ok</span><span class="p">(</span><span class="n">new_file</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function double checks the VCF at the provided path to make
    sure the sample names in the VCF are the same as the sample names
    in the metadata. If they aren't, it looks for the metadata sample
    names as substrings of the VCF sample names. If all metadata
    sample names are in fact substrings of the VCF sample names, it
    creates a tab-delimited text file to guide BCFTools, which it
    uses in a subprocess to rename VCF sample names.</p>

<p>Args:
    animals: A Polars DataFrame of the sample IDs.
    vcf_path: a character string filepath leading to the input VCF.</p>

<p>Returns:
    Result[NewFile, str]: A Result containing either an instance of the
    NewFile dataclass, which contains the  file path to the new VCF output
    by VCFtools, or an informative error message.</p>
</div>


                </section>
                <section id="filter_vcf_samples">
                            <input id="filter_vcf_samples-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filter_vcf_samples</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">vcf_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">animals</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">label</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">Ok</span><span class="p">[</span><span class="n"><a href="#NewFile">NewFile</a></span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">Err</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="filter_vcf_samples-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#filter_vcf_samples"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="filter_vcf_samples-304"><a href="#filter_vcf_samples-304"><span class="linenos">304</span></a><span class="k">def</span> <span class="nf">filter_vcf_samples</span><span class="p">(</span><span class="n">vcf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">animals</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">[</span><span class="n">NewFile</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="filter_vcf_samples-305"><a href="#filter_vcf_samples-305"><span class="linenos">305</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="filter_vcf_samples-306"><a href="#filter_vcf_samples-306"><span class="linenos">306</span></a><span class="sd">        Run VCFTools to filter a VCF based on a text file of sample IDs to keep.</span>
</span><span id="filter_vcf_samples-307"><a href="#filter_vcf_samples-307"><span class="linenos">307</span></a>
</span><span id="filter_vcf_samples-308"><a href="#filter_vcf_samples-308"><span class="linenos">308</span></a><span class="sd">    Args:</span>
</span><span id="filter_vcf_samples-309"><a href="#filter_vcf_samples-309"><span class="linenos">309</span></a><span class="sd">        vcf_path (str): The path to the input VCF file.</span>
</span><span id="filter_vcf_samples-310"><a href="#filter_vcf_samples-310"><span class="linenos">310</span></a><span class="sd">        animals (str): The path to the text file containing sample IDs to keep.</span>
</span><span id="filter_vcf_samples-311"><a href="#filter_vcf_samples-311"><span class="linenos">311</span></a>
</span><span id="filter_vcf_samples-312"><a href="#filter_vcf_samples-312"><span class="linenos">312</span></a><span class="sd">    Returns:</span>
</span><span id="filter_vcf_samples-313"><a href="#filter_vcf_samples-313"><span class="linenos">313</span></a><span class="sd">        Result[NewFile, str]: A Result containing either the new file path to</span>
</span><span id="filter_vcf_samples-314"><a href="#filter_vcf_samples-314"><span class="linenos">314</span></a><span class="sd">        the filtered filtered VCF, or an informative error message.</span>
</span><span id="filter_vcf_samples-315"><a href="#filter_vcf_samples-315"><span class="linenos">315</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="filter_vcf_samples-316"><a href="#filter_vcf_samples-316"><span class="linenos">316</span></a>
</span><span id="filter_vcf_samples-317"><a href="#filter_vcf_samples-317"><span class="linenos">317</span></a>    <span class="c1"># handle the possibility that the VCF is not named or formatted correctly</span>
</span><span id="filter_vcf_samples-318"><a href="#filter_vcf_samples-318"><span class="linenos">318</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.vcf.gz&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.vcf&quot;</span><span class="p">):</span>
</span><span id="filter_vcf_samples-319"><a href="#filter_vcf_samples-319"><span class="linenos">319</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="filter_vcf_samples-320"><a href="#filter_vcf_samples-320"><span class="linenos">320</span></a>            <span class="s2">&quot;VCF is not in a recognizable format. Please double </span><span class="se">\</span>
</span><span id="filter_vcf_samples-321"><a href="#filter_vcf_samples-321"><span class="linenos">321</span></a><span class="s2">                    check that your VCF file is either gzip-compressed and </span><span class="se">\</span>
</span><span id="filter_vcf_samples-322"><a href="#filter_vcf_samples-322"><span class="linenos">322</span></a><span class="s2">                    ends with &#39;.vcf.gz&#39;, or is uncompressed and ends with </span><span class="se">\</span>
</span><span id="filter_vcf_samples-323"><a href="#filter_vcf_samples-323"><span class="linenos">323</span></a><span class="s2">                    &#39;.vcf&#39;.&quot;</span>
</span><span id="filter_vcf_samples-324"><a href="#filter_vcf_samples-324"><span class="linenos">324</span></a>        <span class="p">)</span>
</span><span id="filter_vcf_samples-325"><a href="#filter_vcf_samples-325"><span class="linenos">325</span></a>
</span><span id="filter_vcf_samples-326"><a href="#filter_vcf_samples-326"><span class="linenos">326</span></a>    <span class="c1"># set the VCFtools input format flag based on the VCF file name is now</span>
</span><span id="filter_vcf_samples-327"><a href="#filter_vcf_samples-327"><span class="linenos">327</span></a>    <span class="c1"># guaranteed to be present thanks to the above error-handling</span>
</span><span id="filter_vcf_samples-328"><a href="#filter_vcf_samples-328"><span class="linenos">328</span></a>    <span class="k">if</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.vcf.gz&quot;</span><span class="p">):</span>
</span><span id="filter_vcf_samples-329"><a href="#filter_vcf_samples-329"><span class="linenos">329</span></a>        <span class="n">input_format</span> <span class="o">=</span> <span class="s2">&quot;--gzvcf&quot;</span>
</span><span id="filter_vcf_samples-330"><a href="#filter_vcf_samples-330"><span class="linenos">330</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="filter_vcf_samples-331"><a href="#filter_vcf_samples-331"><span class="linenos">331</span></a>        <span class="n">input_format</span> <span class="o">=</span> <span class="s2">&quot;--vcf&quot;</span>
</span><span id="filter_vcf_samples-332"><a href="#filter_vcf_samples-332"><span class="linenos">332</span></a>
</span><span id="filter_vcf_samples-333"><a href="#filter_vcf_samples-333"><span class="linenos">333</span></a>    <span class="c1"># construct the VCFTools subprocess command as a list</span>
</span><span id="filter_vcf_samples-334"><a href="#filter_vcf_samples-334"><span class="linenos">334</span></a>    <span class="n">vcftools_command</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="filter_vcf_samples-335"><a href="#filter_vcf_samples-335"><span class="linenos">335</span></a>        <span class="s2">&quot;vcftools&quot;</span><span class="p">,</span>
</span><span id="filter_vcf_samples-336"><a href="#filter_vcf_samples-336"><span class="linenos">336</span></a>        <span class="n">input_format</span><span class="p">,</span>
</span><span id="filter_vcf_samples-337"><a href="#filter_vcf_samples-337"><span class="linenos">337</span></a>        <span class="n">vcf_path</span><span class="p">,</span>
</span><span id="filter_vcf_samples-338"><a href="#filter_vcf_samples-338"><span class="linenos">338</span></a>        <span class="s2">&quot;--keep&quot;</span><span class="p">,</span>
</span><span id="filter_vcf_samples-339"><a href="#filter_vcf_samples-339"><span class="linenos">339</span></a>        <span class="n">animals</span><span class="p">,</span>
</span><span id="filter_vcf_samples-340"><a href="#filter_vcf_samples-340"><span class="linenos">340</span></a>        <span class="s2">&quot;--recode&quot;</span><span class="p">,</span>
</span><span id="filter_vcf_samples-341"><a href="#filter_vcf_samples-341"><span class="linenos">341</span></a>        <span class="s2">&quot;--stdout&quot;</span><span class="p">,</span>
</span><span id="filter_vcf_samples-342"><a href="#filter_vcf_samples-342"><span class="linenos">342</span></a>    <span class="p">]</span>
</span><span id="filter_vcf_samples-343"><a href="#filter_vcf_samples-343"><span class="linenos">343</span></a>
</span><span id="filter_vcf_samples-344"><a href="#filter_vcf_samples-344"><span class="linenos">344</span></a>    <span class="c1"># construct the bcftools subprocess command as a list</span>
</span><span id="filter_vcf_samples-345"><a href="#filter_vcf_samples-345"><span class="linenos">345</span></a>    <span class="n">bcftools_command</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="filter_vcf_samples-346"><a href="#filter_vcf_samples-346"><span class="linenos">346</span></a>        <span class="s2">&quot;bcftools&quot;</span><span class="p">,</span>
</span><span id="filter_vcf_samples-347"><a href="#filter_vcf_samples-347"><span class="linenos">347</span></a>        <span class="s2">&quot;view&quot;</span><span class="p">,</span>
</span><span id="filter_vcf_samples-348"><a href="#filter_vcf_samples-348"><span class="linenos">348</span></a>        <span class="s2">&quot;--min-ac&quot;</span><span class="p">,</span>
</span><span id="filter_vcf_samples-349"><a href="#filter_vcf_samples-349"><span class="linenos">349</span></a>        <span class="s2">&quot;1&quot;</span><span class="p">,</span>
</span><span id="filter_vcf_samples-350"><a href="#filter_vcf_samples-350"><span class="linenos">350</span></a>        <span class="s2">&quot;-i&quot;</span><span class="p">,</span>
</span><span id="filter_vcf_samples-351"><a href="#filter_vcf_samples-351"><span class="linenos">351</span></a>        <span class="s2">&quot;COUNT(GT!=&#39;0/0&#39; &amp;&amp; GT!=&#39;0|0&#39; &amp;&amp; GT!=&#39;./.&#39;)&gt;0&quot;</span><span class="p">,</span>
</span><span id="filter_vcf_samples-352"><a href="#filter_vcf_samples-352"><span class="linenos">352</span></a>        <span class="s2">&quot;--output-type&quot;</span><span class="p">,</span>
</span><span id="filter_vcf_samples-353"><a href="#filter_vcf_samples-353"><span class="linenos">353</span></a>        <span class="s2">&quot;z&quot;</span><span class="p">,</span>
</span><span id="filter_vcf_samples-354"><a href="#filter_vcf_samples-354"><span class="linenos">354</span></a>        <span class="s2">&quot;-&quot;</span><span class="p">,</span>
</span><span id="filter_vcf_samples-355"><a href="#filter_vcf_samples-355"><span class="linenos">355</span></a>    <span class="p">]</span>
</span><span id="filter_vcf_samples-356"><a href="#filter_vcf_samples-356"><span class="linenos">356</span></a>
</span><span id="filter_vcf_samples-357"><a href="#filter_vcf_samples-357"><span class="linenos">357</span></a>    <span class="c1"># run commands</span>
</span><span id="filter_vcf_samples-358"><a href="#filter_vcf_samples-358"><span class="linenos">358</span></a>    <span class="n">new_vcf</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">_filtered.vcf.gz&quot;</span>
</span><span id="filter_vcf_samples-359"><a href="#filter_vcf_samples-359"><span class="linenos">359</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">new_vcf</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">vcf_handle</span><span class="p">:</span>
</span><span id="filter_vcf_samples-360"><a href="#filter_vcf_samples-360"><span class="linenos">360</span></a>        <span class="n">vcftools_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
</span><span id="filter_vcf_samples-361"><a href="#filter_vcf_samples-361"><span class="linenos">361</span></a>            <span class="n">vcftools_command</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
</span><span id="filter_vcf_samples-362"><a href="#filter_vcf_samples-362"><span class="linenos">362</span></a>        <span class="p">)</span>
</span><span id="filter_vcf_samples-363"><a href="#filter_vcf_samples-363"><span class="linenos">363</span></a>        <span class="n">gzip_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
</span><span id="filter_vcf_samples-364"><a href="#filter_vcf_samples-364"><span class="linenos">364</span></a>            <span class="p">[</span><span class="s2">&quot;gzip&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">],</span>
</span><span id="filter_vcf_samples-365"><a href="#filter_vcf_samples-365"><span class="linenos">365</span></a>            <span class="n">stdin</span><span class="o">=</span><span class="n">vcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
</span><span id="filter_vcf_samples-366"><a href="#filter_vcf_samples-366"><span class="linenos">366</span></a>            <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="filter_vcf_samples-367"><a href="#filter_vcf_samples-367"><span class="linenos">367</span></a>            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="filter_vcf_samples-368"><a href="#filter_vcf_samples-368"><span class="linenos">368</span></a>        <span class="p">)</span>
</span><span id="filter_vcf_samples-369"><a href="#filter_vcf_samples-369"><span class="linenos">369</span></a>        <span class="n">bcftools_process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
</span><span id="filter_vcf_samples-370"><a href="#filter_vcf_samples-370"><span class="linenos">370</span></a>            <span class="n">bcftools_command</span><span class="p">,</span>
</span><span id="filter_vcf_samples-371"><a href="#filter_vcf_samples-371"><span class="linenos">371</span></a>            <span class="n">stdin</span><span class="o">=</span><span class="n">gzip_process</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
</span><span id="filter_vcf_samples-372"><a href="#filter_vcf_samples-372"><span class="linenos">372</span></a>            <span class="n">stdout</span><span class="o">=</span><span class="n">vcf_handle</span><span class="p">,</span>
</span><span id="filter_vcf_samples-373"><a href="#filter_vcf_samples-373"><span class="linenos">373</span></a>            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
</span><span id="filter_vcf_samples-374"><a href="#filter_vcf_samples-374"><span class="linenos">374</span></a>        <span class="p">)</span>
</span><span id="filter_vcf_samples-375"><a href="#filter_vcf_samples-375"><span class="linenos">375</span></a>
</span><span id="filter_vcf_samples-376"><a href="#filter_vcf_samples-376"><span class="linenos">376</span></a>        <span class="c1"># Allow vcftools to receive a SIGPIPE if gzip exits</span>
</span><span id="filter_vcf_samples-377"><a href="#filter_vcf_samples-377"><span class="linenos">377</span></a>        <span class="k">if</span> <span class="n">vcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
</span><span id="filter_vcf_samples-378"><a href="#filter_vcf_samples-378"><span class="linenos">378</span></a>            <span class="n">vcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="filter_vcf_samples-379"><a href="#filter_vcf_samples-379"><span class="linenos">379</span></a>
</span><span id="filter_vcf_samples-380"><a href="#filter_vcf_samples-380"><span class="linenos">380</span></a>        <span class="c1"># Allow bcftools to receive a SIGPIPE if gzip exits</span>
</span><span id="filter_vcf_samples-381"><a href="#filter_vcf_samples-381"><span class="linenos">381</span></a>        <span class="k">if</span> <span class="n">bcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="p">:</span>
</span><span id="filter_vcf_samples-382"><a href="#filter_vcf_samples-382"><span class="linenos">382</span></a>            <span class="n">bcftools_process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="filter_vcf_samples-383"><a href="#filter_vcf_samples-383"><span class="linenos">383</span></a>
</span><span id="filter_vcf_samples-384"><a href="#filter_vcf_samples-384"><span class="linenos">384</span></a>        <span class="c1"># Wait for processes to complete and get their exit codes and stderr</span>
</span><span id="filter_vcf_samples-385"><a href="#filter_vcf_samples-385"><span class="linenos">385</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">vcftools_stderr</span> <span class="o">=</span> <span class="n">vcftools_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</span><span id="filter_vcf_samples-386"><a href="#filter_vcf_samples-386"><span class="linenos">386</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">gzip_stderr</span> <span class="o">=</span> <span class="n">gzip_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</span><span id="filter_vcf_samples-387"><a href="#filter_vcf_samples-387"><span class="linenos">387</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">bcftools_stderr</span> <span class="o">=</span> <span class="n">bcftools_process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</span><span id="filter_vcf_samples-388"><a href="#filter_vcf_samples-388"><span class="linenos">388</span></a>
</span><span id="filter_vcf_samples-389"><a href="#filter_vcf_samples-389"><span class="linenos">389</span></a>    <span class="c1"># Get the exit code and give an informative error message if it isn&#39;t 0</span>
</span><span id="filter_vcf_samples-390"><a href="#filter_vcf_samples-390"><span class="linenos">390</span></a>    <span class="n">vcftools_exit_code</span> <span class="o">=</span> <span class="n">vcftools_process</span><span class="o">.</span><span class="n">returncode</span>
</span><span id="filter_vcf_samples-391"><a href="#filter_vcf_samples-391"><span class="linenos">391</span></a>    <span class="k">if</span> <span class="n">vcftools_exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="filter_vcf_samples-392"><a href="#filter_vcf_samples-392"><span class="linenos">392</span></a>        <span class="n">vcftools_error</span> <span class="o">=</span> <span class="n">vcftools_stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="filter_vcf_samples-393"><a href="#filter_vcf_samples-393"><span class="linenos">393</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="filter_vcf_samples-394"><a href="#filter_vcf_samples-394"><span class="linenos">394</span></a>            <span class="sa">f</span><span class="s2">&quot;VCF filtering encountered an error with exit code </span><span class="si">{</span><span class="n">vcftools_exit_code</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\</span>
</span><span id="filter_vcf_samples-395"><a href="#filter_vcf_samples-395"><span class="linenos">395</span></a><span class="s2">                        </span><span class="si">{</span><span class="n">vcftools_error</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="filter_vcf_samples-396"><a href="#filter_vcf_samples-396"><span class="linenos">396</span></a>        <span class="p">)</span>
</span><span id="filter_vcf_samples-397"><a href="#filter_vcf_samples-397"><span class="linenos">397</span></a>    <span class="n">gzip_exit_code</span> <span class="o">=</span> <span class="n">gzip_process</span><span class="o">.</span><span class="n">returncode</span>
</span><span id="filter_vcf_samples-398"><a href="#filter_vcf_samples-398"><span class="linenos">398</span></a>    <span class="k">if</span> <span class="n">gzip_exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="filter_vcf_samples-399"><a href="#filter_vcf_samples-399"><span class="linenos">399</span></a>        <span class="n">gzip_error</span> <span class="o">=</span> <span class="n">gzip_stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="filter_vcf_samples-400"><a href="#filter_vcf_samples-400"><span class="linenos">400</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="filter_vcf_samples-401"><a href="#filter_vcf_samples-401"><span class="linenos">401</span></a>            <span class="sa">f</span><span class="s2">&quot;VCF filtering encountered an error with exit code </span><span class="si">{</span><span class="n">gzip_exit_code</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\</span>
</span><span id="filter_vcf_samples-402"><a href="#filter_vcf_samples-402"><span class="linenos">402</span></a><span class="s2">                        </span><span class="si">{</span><span class="n">gzip_error</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="filter_vcf_samples-403"><a href="#filter_vcf_samples-403"><span class="linenos">403</span></a>        <span class="p">)</span>
</span><span id="filter_vcf_samples-404"><a href="#filter_vcf_samples-404"><span class="linenos">404</span></a>    <span class="n">bcftools_exit_code</span> <span class="o">=</span> <span class="n">bcftools_process</span><span class="o">.</span><span class="n">returncode</span>
</span><span id="filter_vcf_samples-405"><a href="#filter_vcf_samples-405"><span class="linenos">405</span></a>    <span class="k">if</span> <span class="n">bcftools_exit_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="filter_vcf_samples-406"><a href="#filter_vcf_samples-406"><span class="linenos">406</span></a>        <span class="n">bcftools_error</span> <span class="o">=</span> <span class="n">bcftools_stderr</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="filter_vcf_samples-407"><a href="#filter_vcf_samples-407"><span class="linenos">407</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="filter_vcf_samples-408"><a href="#filter_vcf_samples-408"><span class="linenos">408</span></a>            <span class="sa">f</span><span class="s2">&quot;VCF INFO reformatting failed with </span><span class="si">{</span><span class="n">bcftools_exit_code</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\</span>
</span><span id="filter_vcf_samples-409"><a href="#filter_vcf_samples-409"><span class="linenos">409</span></a><span class="s2">                        </span><span class="si">{</span><span class="n">bcftools_error</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="filter_vcf_samples-410"><a href="#filter_vcf_samples-410"><span class="linenos">410</span></a>        <span class="p">)</span>
</span><span id="filter_vcf_samples-411"><a href="#filter_vcf_samples-411"><span class="linenos">411</span></a>
</span><span id="filter_vcf_samples-412"><a href="#filter_vcf_samples-412"><span class="linenos">412</span></a>    <span class="c1"># remove VCFtools log files</span>
</span><span id="filter_vcf_samples-413"><a href="#filter_vcf_samples-413"><span class="linenos">413</span></a>    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.log&quot;</span><span class="p">):</span>
</span><span id="filter_vcf_samples-414"><a href="#filter_vcf_samples-414"><span class="linenos">414</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="filter_vcf_samples-415"><a href="#filter_vcf_samples-415"><span class="linenos">415</span></a>
</span><span id="filter_vcf_samples-416"><a href="#filter_vcf_samples-416"><span class="linenos">416</span></a>    <span class="n">new_file</span> <span class="o">=</span> <span class="n">NewFile</span><span class="p">(</span><span class="n">new_vcf</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">new_vcf</span><span class="p">))</span>
</span><span id="filter_vcf_samples-417"><a href="#filter_vcf_samples-417"><span class="linenos">417</span></a>    <span class="k">return</span> <span class="n">Ok</span><span class="p">(</span><span class="n">new_file</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Run VCFTools to filter a VCF based on a text file of sample IDs to keep.</p>

<p>Args:
    vcf_path (str): The path to the input VCF file.
    animals (str): The path to the text file containing sample IDs to keep.</p>

<p>Returns:
    Result[NewFile, str]: A Result containing either the new file path to
    the filtered filtered VCF, or an informative error message.</p>
</div>


                </section>
                <section id="collect_filtered_positions">
                            <input id="collect_filtered_positions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">collect_filtered_positions</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">vcf_path</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">Ok</span><span class="p">[</span><span class="n">polars</span><span class="o">.</span><span class="n">lazyframe</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">],</span> <span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">Err</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="collect_filtered_positions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#collect_filtered_positions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="collect_filtered_positions-420"><a href="#collect_filtered_positions-420"><span class="linenos">420</span></a><span class="k">def</span> <span class="nf">collect_filtered_positions</span><span class="p">(</span><span class="n">vcf_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Result</span><span class="p">[</span><span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="collect_filtered_positions-421"><a href="#collect_filtered_positions-421"><span class="linenos">421</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="collect_filtered_positions-422"><a href="#collect_filtered_positions-422"><span class="linenos">422</span></a><span class="sd">        Use BCFtools to define the positions that are still present in the</span>
</span><span id="collect_filtered_positions-423"><a href="#collect_filtered_positions-423"><span class="linenos">423</span></a><span class="sd">        filtered VCF. This positions will be cross-referenced downstream</span>
</span><span id="collect_filtered_positions-424"><a href="#collect_filtered_positions-424"><span class="linenos">424</span></a><span class="sd">        with a table of CADD scores, making it possible to filter a CADD</span>
</span><span id="collect_filtered_positions-425"><a href="#collect_filtered_positions-425"><span class="linenos">425</span></a><span class="sd">        table without requiring that table to be annotated with sample IDs.</span>
</span><span id="collect_filtered_positions-426"><a href="#collect_filtered_positions-426"><span class="linenos">426</span></a>
</span><span id="collect_filtered_positions-427"><a href="#collect_filtered_positions-427"><span class="linenos">427</span></a><span class="sd">    Args:</span>
</span><span id="collect_filtered_positions-428"><a href="#collect_filtered_positions-428"><span class="linenos">428</span></a><span class="sd">        vcf_path: the path to the VCF to be assessed.</span>
</span><span id="collect_filtered_positions-429"><a href="#collect_filtered_positions-429"><span class="linenos">429</span></a>
</span><span id="collect_filtered_positions-430"><a href="#collect_filtered_positions-430"><span class="linenos">430</span></a><span class="sd">    Returns:</span>
</span><span id="collect_filtered_positions-431"><a href="#collect_filtered_positions-431"><span class="linenos">431</span></a><span class="sd">        Result[pl.LazyFrame, str]: A result containing either a Polars</span>
</span><span id="collect_filtered_positions-432"><a href="#collect_filtered_positions-432"><span class="linenos">432</span></a><span class="sd">        LazyFrame of the positions, or an informative error message.</span>
</span><span id="collect_filtered_positions-433"><a href="#collect_filtered_positions-433"><span class="linenos">433</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="collect_filtered_positions-434"><a href="#collect_filtered_positions-434"><span class="linenos">434</span></a>
</span><span id="collect_filtered_positions-435"><a href="#collect_filtered_positions-435"><span class="linenos">435</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.vcf.gz&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">vcf_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.vcf&quot;</span><span class="p">):</span>
</span><span id="collect_filtered_positions-436"><a href="#collect_filtered_positions-436"><span class="linenos">436</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="collect_filtered_positions-437"><a href="#collect_filtered_positions-437"><span class="linenos">437</span></a>            <span class="s2">&quot;VCF is not in a recognizable format. Please double </span><span class="se">\</span>
</span><span id="collect_filtered_positions-438"><a href="#collect_filtered_positions-438"><span class="linenos">438</span></a><span class="s2">                    check that your VCF file is either gzip-compressed and </span><span class="se">\</span>
</span><span id="collect_filtered_positions-439"><a href="#collect_filtered_positions-439"><span class="linenos">439</span></a><span class="s2">                    ends with &#39;.vcf.gz&#39;, or is uncompressed and ends with </span><span class="se">\</span>
</span><span id="collect_filtered_positions-440"><a href="#collect_filtered_positions-440"><span class="linenos">440</span></a><span class="s2">                    &#39;.vcf&#39;.&quot;</span>
</span><span id="collect_filtered_positions-441"><a href="#collect_filtered_positions-441"><span class="linenos">441</span></a>        <span class="p">)</span>
</span><span id="collect_filtered_positions-442"><a href="#collect_filtered_positions-442"><span class="linenos">442</span></a>
</span><span id="collect_filtered_positions-443"><a href="#collect_filtered_positions-443"><span class="linenos">443</span></a>    <span class="c1"># define the command</span>
</span><span id="collect_filtered_positions-444"><a href="#collect_filtered_positions-444"><span class="linenos">444</span></a>    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;bcftools&quot;</span><span class="p">,</span> <span class="s2">&quot;query&quot;</span><span class="p">,</span> <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;%CHROM</span><span class="se">\t</span><span class="s2">%POS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">vcf_path</span><span class="p">]</span>
</span><span id="collect_filtered_positions-445"><a href="#collect_filtered_positions-445"><span class="linenos">445</span></a>
</span><span id="collect_filtered_positions-446"><a href="#collect_filtered_positions-446"><span class="linenos">446</span></a>    <span class="c1"># Run the command and collect the output</span>
</span><span id="collect_filtered_positions-447"><a href="#collect_filtered_positions-447"><span class="linenos">447</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span><span id="collect_filtered_positions-448"><a href="#collect_filtered_positions-448"><span class="linenos">448</span></a>        <span class="n">command</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span>
</span><span id="collect_filtered_positions-449"><a href="#collect_filtered_positions-449"><span class="linenos">449</span></a>    <span class="p">)</span>
</span><span id="collect_filtered_positions-450"><a href="#collect_filtered_positions-450"><span class="linenos">450</span></a>
</span><span id="collect_filtered_positions-451"><a href="#collect_filtered_positions-451"><span class="linenos">451</span></a>    <span class="c1"># Check if the command was unsuccessful</span>
</span><span id="collect_filtered_positions-452"><a href="#collect_filtered_positions-452"><span class="linenos">452</span></a>    <span class="n">exitcode</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span>
</span><span id="collect_filtered_positions-453"><a href="#collect_filtered_positions-453"><span class="linenos">453</span></a>    <span class="k">if</span> <span class="n">exitcode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="collect_filtered_positions-454"><a href="#collect_filtered_positions-454"><span class="linenos">454</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="collect_filtered_positions-455"><a href="#collect_filtered_positions-455"><span class="linenos">455</span></a>            <span class="sa">f</span><span class="s2">&quot;BCFtools failed to find positions in the provided VCF and</span><span class="se">\</span>
</span><span id="collect_filtered_positions-456"><a href="#collect_filtered_positions-456"><span class="linenos">456</span></a><span class="s2">                    terminated with exit code </span><span class="si">{</span><span class="n">exitcode</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">stderr</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="collect_filtered_positions-457"><a href="#collect_filtered_positions-457"><span class="linenos">457</span></a>        <span class="p">)</span>
</span><span id="collect_filtered_positions-458"><a href="#collect_filtered_positions-458"><span class="linenos">458</span></a>
</span><span id="collect_filtered_positions-459"><a href="#collect_filtered_positions-459"><span class="linenos">459</span></a>    <span class="c1"># The stdout contains the positions, one per line</span>
</span><span id="collect_filtered_positions-460"><a href="#collect_filtered_positions-460"><span class="linenos">460</span></a>    <span class="n">raw_positions</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="collect_filtered_positions-461"><a href="#collect_filtered_positions-461"><span class="linenos">461</span></a>
</span><span id="collect_filtered_positions-462"><a href="#collect_filtered_positions-462"><span class="linenos">462</span></a>    <span class="c1"># unpack the results into chromosomes and positions</span>
</span><span id="collect_filtered_positions-463"><a href="#collect_filtered_positions-463"><span class="linenos">463</span></a>    <span class="n">chromosomes</span><span class="p">,</span> <span class="n">positions_str</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">raw_positions</span><span class="p">])</span>
</span><span id="collect_filtered_positions-464"><a href="#collect_filtered_positions-464"><span class="linenos">464</span></a>    <span class="n">positions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="collect_filtered_positions-465"><a href="#collect_filtered_positions-465"><span class="linenos">465</span></a>        <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">positions_str</span><span class="p">)</span>
</span><span id="collect_filtered_positions-466"><a href="#collect_filtered_positions-466"><span class="linenos">466</span></a>    <span class="p">)</span>  <span class="c1"># Convert positions to integers</span>
</span><span id="collect_filtered_positions-467"><a href="#collect_filtered_positions-467"><span class="linenos">467</span></a>
</span><span id="collect_filtered_positions-468"><a href="#collect_filtered_positions-468"><span class="linenos">468</span></a>    <span class="c1"># Convert to integers and double check that the list isn&#39;t empty</span>
</span><span id="collect_filtered_positions-469"><a href="#collect_filtered_positions-469"><span class="linenos">469</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="collect_filtered_positions-470"><a href="#collect_filtered_positions-470"><span class="linenos">470</span></a>        <span class="k">return</span> <span class="n">Err</span><span class="p">(</span>
</span><span id="collect_filtered_positions-471"><a href="#collect_filtered_positions-471"><span class="linenos">471</span></a>            <span class="s2">&quot;BCFtools encountered a silent error such that the constructed</span><span class="se">\</span>
</span><span id="collect_filtered_positions-472"><a href="#collect_filtered_positions-472"><span class="linenos">472</span></a><span class="s2">                    list of positions is empty&quot;</span>
</span><span id="collect_filtered_positions-473"><a href="#collect_filtered_positions-473"><span class="linenos">473</span></a>        <span class="p">)</span>
</span><span id="collect_filtered_positions-474"><a href="#collect_filtered_positions-474"><span class="linenos">474</span></a>
</span><span id="collect_filtered_positions-475"><a href="#collect_filtered_positions-475"><span class="linenos">475</span></a>    <span class="c1"># convert the list to a polars dataframe and return it</span>
</span><span id="collect_filtered_positions-476"><a href="#collect_filtered_positions-476"><span class="linenos">476</span></a>    <span class="n">position_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="collect_filtered_positions-477"><a href="#collect_filtered_positions-477"><span class="linenos">477</span></a>        <span class="n">pl</span><span class="o">.</span><span class="n">LazyFrame</span><span class="p">({</span><span class="s2">&quot;Chromosomes&quot;</span><span class="p">:</span> <span class="n">chromosomes</span><span class="p">,</span> <span class="s2">&quot;Positions&quot;</span><span class="p">:</span> <span class="n">positions</span><span class="p">})</span>
</span><span id="collect_filtered_positions-478"><a href="#collect_filtered_positions-478"><span class="linenos">478</span></a>        <span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
</span><span id="collect_filtered_positions-479"><a href="#collect_filtered_positions-479"><span class="linenos">479</span></a>            <span class="n">pl</span><span class="o">.</span><span class="n">concat_str</span><span class="p">(</span>
</span><span id="collect_filtered_positions-480"><a href="#collect_filtered_positions-480"><span class="linenos">480</span></a>                <span class="p">[</span>
</span><span id="collect_filtered_positions-481"><a href="#collect_filtered_positions-481"><span class="linenos">481</span></a>                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Chromosomes&quot;</span><span class="p">),</span>
</span><span id="collect_filtered_positions-482"><a href="#collect_filtered_positions-482"><span class="linenos">482</span></a>                    <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Positions&quot;</span><span class="p">),</span>
</span><span id="collect_filtered_positions-483"><a href="#collect_filtered_positions-483"><span class="linenos">483</span></a>                <span class="p">],</span>
</span><span id="collect_filtered_positions-484"><a href="#collect_filtered_positions-484"><span class="linenos">484</span></a>                <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
</span><span id="collect_filtered_positions-485"><a href="#collect_filtered_positions-485"><span class="linenos">485</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Full Position&quot;</span><span class="p">),</span>
</span><span id="collect_filtered_positions-486"><a href="#collect_filtered_positions-486"><span class="linenos">486</span></a>        <span class="p">)</span>
</span><span id="collect_filtered_positions-487"><a href="#collect_filtered_positions-487"><span class="linenos">487</span></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;Full Position&quot;</span><span class="p">)</span>
</span><span id="collect_filtered_positions-488"><a href="#collect_filtered_positions-488"><span class="linenos">488</span></a>        <span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
</span><span id="collect_filtered_positions-489"><a href="#collect_filtered_positions-489"><span class="linenos">489</span></a>            <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Full Position&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace_all</span><span class="p">(</span><span class="s2">&quot;chr&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Full Position&quot;</span><span class="p">)</span>
</span><span id="collect_filtered_positions-490"><a href="#collect_filtered_positions-490"><span class="linenos">490</span></a>        <span class="p">)</span>
</span><span id="collect_filtered_positions-491"><a href="#collect_filtered_positions-491"><span class="linenos">491</span></a>    <span class="p">)</span>
</span><span id="collect_filtered_positions-492"><a href="#collect_filtered_positions-492"><span class="linenos">492</span></a>    <span class="k">return</span> <span class="n">Ok</span><span class="p">(</span><span class="n">position_df</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Use BCFtools to define the positions that are still present in the
    filtered VCF. This positions will be cross-referenced downstream
    with a table of CADD scores, making it possible to filter a CADD
    table without requiring that table to be annotated with sample IDs.</p>

<p>Args:
    vcf_path: the path to the VCF to be assessed.</p>

<p>Returns:
    Result[pl.LazyFrame, str]: A result containing either a Polars
    LazyFrame of the positions, or an informative error message.</p>
</div>


                </section>
                <section id="main">
                            <input id="main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">main</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="main-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#main"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="main-495"><a href="#main-495"><span class="linenos">495</span></a><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="main-496"><a href="#main-496"><span class="linenos">496</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="main-497"><a href="#main-497"><span class="linenos">497</span></a><span class="sd">    Main handles I/O, coordinates the flow of data through the above functions,</span>
</span><span id="main-498"><a href="#main-498"><span class="linenos">498</span></a><span class="sd">    and exposes any errors.</span>
</span><span id="main-499"><a href="#main-499"><span class="linenos">499</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="main-500"><a href="#main-500"><span class="linenos">500</span></a>
</span><span id="main-501"><a href="#main-501"><span class="linenos">501</span></a>    <span class="c1"># collect command line argument result</span>
</span><span id="main-502"><a href="#main-502"><span class="linenos">502</span></a>    <span class="n">arg_result</span> <span class="o">=</span> <span class="n">parse_command_line_args</span><span class="p">()</span>
</span><span id="main-503"><a href="#main-503"><span class="linenos">503</span></a>    <span class="k">match</span> <span class="n">arg_result</span><span class="p">:</span>
</span><span id="main-504"><a href="#main-504"><span class="linenos">504</span></a>        <span class="k">case</span> <span class="n">Ok</span><span class="p">(</span><span class="n">arguments</span><span class="p">):</span>
</span><span id="main-505"><a href="#main-505"><span class="linenos">505</span></a>            <span class="n">vcf_path</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">vcf</span>
</span><span id="main-506"><a href="#main-506"><span class="linenos">506</span></a>            <span class="n">table_path</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">cadd_table</span>
</span><span id="main-507"><a href="#main-507"><span class="linenos">507</span></a>            <span class="n">animals</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">animal_file</span>
</span><span id="main-508"><a href="#main-508"><span class="linenos">508</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">label</span>
</span><span id="main-509"><a href="#main-509"><span class="linenos">509</span></a>            <span class="n">config</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">config</span>
</span><span id="main-510"><a href="#main-510"><span class="linenos">510</span></a>            <span class="n">verbosity</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">verbose</span>
</span><span id="main-511"><a href="#main-511"><span class="linenos">511</span></a>        <span class="k">case</span> <span class="n">Err</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
</span><span id="main-512"><a href="#main-512"><span class="linenos">512</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="main-513"><a href="#main-513"><span class="linenos">513</span></a>
</span><span id="main-514"><a href="#main-514"><span class="linenos">514</span></a>    <span class="c1"># define configuration parameters</span>
</span><span id="main-515"><a href="#main-515"><span class="linenos">515</span></a>    <span class="n">config_result</span> <span class="o">=</span> <span class="n">parse_configurations</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span><span id="main-516"><a href="#main-516"><span class="linenos">516</span></a>    <span class="k">match</span> <span class="n">config_result</span><span class="p">:</span>
</span><span id="main-517"><a href="#main-517"><span class="linenos">517</span></a>        <span class="k">case</span> <span class="n">Ok</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
</span><span id="main-518"><a href="#main-518"><span class="linenos">518</span></a>            <span class="k">pass</span>
</span><span id="main-519"><a href="#main-519"><span class="linenos">519</span></a>        <span class="k">case</span> <span class="n">Err</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
</span><span id="main-520"><a href="#main-520"><span class="linenos">520</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="main-521"><a href="#main-521"><span class="linenos">521</span></a>
</span><span id="main-522"><a href="#main-522"><span class="linenos">522</span></a>    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
</span><span id="main-523"><a href="#main-523"><span class="linenos">523</span></a>        <span class="n">ic</span><span class="p">()</span>
</span><span id="main-524"><a href="#main-524"><span class="linenos">524</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Command line arguments successfully parsed.&quot;</span><span class="p">)</span>
</span><span id="main-525"><a href="#main-525"><span class="linenos">525</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="main-526"><a href="#main-526"><span class="linenos">526</span></a>            <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span>
</span><span id="main-527"><a href="#main-527"><span class="linenos">527</span></a>                <span class="sa">f</span><span class="s2">&quot;Running on the following files provided in the command line with label &#39;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
</span><span id="main-528"><a href="#main-528"><span class="linenos">528</span></a>            <span class="p">)</span>
</span><span id="main-529"><a href="#main-529"><span class="linenos">529</span></a>        <span class="p">)</span>
</span><span id="main-530"><a href="#main-530"><span class="linenos">530</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">vcf_path</span><span class="p">)</span>
</span><span id="main-531"><a href="#main-531"><span class="linenos">531</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">table_path</span><span class="p">)</span>
</span><span id="main-532"><a href="#main-532"><span class="linenos">532</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span>
</span><span id="main-533"><a href="#main-533"><span class="linenos">533</span></a>
</span><span id="main-534"><a href="#main-534"><span class="linenos">534</span></a>    <span class="c1"># make sure animal names match the sample IDs in the VCF</span>
</span><span id="main-535"><a href="#main-535"><span class="linenos">535</span></a>    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
</span><span id="main-536"><a href="#main-536"><span class="linenos">536</span></a>        <span class="n">ic</span><span class="p">()</span>
</span><span id="main-537"><a href="#main-537"><span class="linenos">537</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="main-538"><a href="#main-538"><span class="linenos">538</span></a>            <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span>
</span><span id="main-539"><a href="#main-539"><span class="linenos">539</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="main-540"><a href="#main-540"><span class="linenos">540</span></a><span class="sd">                Reading animal names from text file provided via the command line argument </span>
</span><span id="main-541"><a href="#main-541"><span class="linenos">541</span></a><span class="sd">                `--animal_file`/`-a`.</span>
</span><span id="main-542"><a href="#main-542"><span class="linenos">542</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="main-543"><a href="#main-543"><span class="linenos">543</span></a>            <span class="p">)</span>
</span><span id="main-544"><a href="#main-544"><span class="linenos">544</span></a>        <span class="p">)</span>
</span><span id="main-545"><a href="#main-545"><span class="linenos">545</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span>
</span><span id="main-546"><a href="#main-546"><span class="linenos">546</span></a>    <span class="n">animals_df</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="main-547"><a href="#main-547"><span class="linenos">547</span></a>        <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="main-548"><a href="#main-548"><span class="linenos">548</span></a>            <span class="n">animals</span><span class="p">,</span>
</span><span id="main-549"><a href="#main-549"><span class="linenos">549</span></a>            <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="main-550"><a href="#main-550"><span class="linenos">550</span></a>            <span class="n">null_values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">],</span>
</span><span id="main-551"><a href="#main-551"><span class="linenos">551</span></a>            <span class="n">has_header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="main-552"><a href="#main-552"><span class="linenos">552</span></a>            <span class="n">new_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Sample ID&quot;</span><span class="p">],</span>
</span><span id="main-553"><a href="#main-553"><span class="linenos">553</span></a>        <span class="p">)</span>
</span><span id="main-554"><a href="#main-554"><span class="linenos">554</span></a>        <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">([</span><span class="s2">&quot;Sample ID&quot;</span><span class="p">]))</span>
</span><span id="main-555"><a href="#main-555"><span class="linenos">555</span></a>        <span class="o">.</span><span class="n">drop_nulls</span><span class="p">()</span>
</span><span id="main-556"><a href="#main-556"><span class="linenos">556</span></a>    <span class="p">)</span>
</span><span id="main-557"><a href="#main-557"><span class="linenos">557</span></a>    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
</span><span id="main-558"><a href="#main-558"><span class="linenos">558</span></a>        <span class="n">ic</span><span class="p">()</span>
</span><span id="main-559"><a href="#main-559"><span class="linenos">559</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cross-referencing sample IDs between the VCF and provided animal table:&quot;</span><span class="p">)</span>
</span><span id="main-560"><a href="#main-560"><span class="linenos">560</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">vcf_path</span><span class="p">)</span>
</span><span id="main-561"><a href="#main-561"><span class="linenos">561</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span>
</span><span id="main-562"><a href="#main-562"><span class="linenos">562</span></a>    <span class="n">unify_result</span> <span class="o">=</span> <span class="n">unify_sample_names</span><span class="p">(</span><span class="n">animals_df</span><span class="p">,</span> <span class="n">vcf_path</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</span><span id="main-563"><a href="#main-563"><span class="linenos">563</span></a>    <span class="k">match</span> <span class="n">unify_result</span><span class="p">:</span>
</span><span id="main-564"><a href="#main-564"><span class="linenos">564</span></a>        <span class="k">case</span> <span class="n">Ok</span><span class="p">(</span><span class="n">new_file</span><span class="p">):</span>
</span><span id="main-565"><a href="#main-565"><span class="linenos">565</span></a>            <span class="n">renamed_vcf_path</span> <span class="o">=</span> <span class="n">new_file</span><span class="o">.</span><span class="n">path</span>
</span><span id="main-566"><a href="#main-566"><span class="linenos">566</span></a>        <span class="k">case</span> <span class="n">Err</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
</span><span id="main-567"><a href="#main-567"><span class="linenos">567</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="main-568"><a href="#main-568"><span class="linenos">568</span></a>
</span><span id="main-569"><a href="#main-569"><span class="linenos">569</span></a>    <span class="c1"># filter the VCF</span>
</span><span id="main-570"><a href="#main-570"><span class="linenos">570</span></a>    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
</span><span id="main-571"><a href="#main-571"><span class="linenos">571</span></a>        <span class="n">ic</span><span class="p">()</span>
</span><span id="main-572"><a href="#main-572"><span class="linenos">572</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="main-573"><a href="#main-573"><span class="linenos">573</span></a>            <span class="s2">&quot;No errors encountered while matching VCF sample IDs to animal file sample IDs.&quot;</span>
</span><span id="main-574"><a href="#main-574"><span class="linenos">574</span></a>        <span class="p">)</span>
</span><span id="main-575"><a href="#main-575"><span class="linenos">575</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="main-576"><a href="#main-576"><span class="linenos">576</span></a>            <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span>
</span><span id="main-577"><a href="#main-577"><span class="linenos">577</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="main-578"><a href="#main-578"><span class="linenos">578</span></a><span class="sd">                Now that sample IDs are the same across the metadata and the VCF, filter down to</span>
</span><span id="main-579"><a href="#main-579"><span class="linenos">579</span></a><span class="sd">                the desired samples provided in:</span>
</span><span id="main-580"><a href="#main-580"><span class="linenos">580</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="main-581"><a href="#main-581"><span class="linenos">581</span></a>            <span class="p">)</span>
</span><span id="main-582"><a href="#main-582"><span class="linenos">582</span></a>        <span class="p">)</span>
</span><span id="main-583"><a href="#main-583"><span class="linenos">583</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">animals</span><span class="p">)</span>
</span><span id="main-584"><a href="#main-584"><span class="linenos">584</span></a>    <span class="n">filtering_result</span> <span class="o">=</span> <span class="n">filter_vcf_samples</span><span class="p">(</span><span class="n">renamed_vcf_path</span><span class="p">,</span> <span class="n">animals</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</span><span id="main-585"><a href="#main-585"><span class="linenos">585</span></a>    <span class="k">match</span> <span class="n">filtering_result</span><span class="p">:</span>
</span><span id="main-586"><a href="#main-586"><span class="linenos">586</span></a>        <span class="k">case</span> <span class="n">Ok</span><span class="p">(</span><span class="n">filtered_file</span><span class="p">):</span>
</span><span id="main-587"><a href="#main-587"><span class="linenos">587</span></a>            <span class="n">filtered_vcf</span> <span class="o">=</span> <span class="n">filtered_file</span><span class="o">.</span><span class="n">path</span>
</span><span id="main-588"><a href="#main-588"><span class="linenos">588</span></a>        <span class="k">case</span> <span class="n">Err</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
</span><span id="main-589"><a href="#main-589"><span class="linenos">589</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="main-590"><a href="#main-590"><span class="linenos">590</span></a>
</span><span id="main-591"><a href="#main-591"><span class="linenos">591</span></a>    <span class="c1"># define the positions</span>
</span><span id="main-592"><a href="#main-592"><span class="linenos">592</span></a>    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
</span><span id="main-593"><a href="#main-593"><span class="linenos">593</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VCF sample filtering completed successfully.&quot;</span><span class="p">)</span>
</span><span id="main-594"><a href="#main-594"><span class="linenos">594</span></a>        <span class="n">ic</span><span class="p">()</span>
</span><span id="main-595"><a href="#main-595"><span class="linenos">595</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="main-596"><a href="#main-596"><span class="linenos">596</span></a>            <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span>
</span><span id="main-597"><a href="#main-597"><span class="linenos">597</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="main-598"><a href="#main-598"><span class="linenos">598</span></a><span class="sd">                With undesired animals removed, collect the remaining chromosomes and positions</span>
</span><span id="main-599"><a href="#main-599"><span class="linenos">599</span></a><span class="sd">                with variants in at least one sample.</span>
</span><span id="main-600"><a href="#main-600"><span class="linenos">600</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="main-601"><a href="#main-601"><span class="linenos">601</span></a>            <span class="p">)</span>
</span><span id="main-602"><a href="#main-602"><span class="linenos">602</span></a>        <span class="p">)</span>
</span><span id="main-603"><a href="#main-603"><span class="linenos">603</span></a>    <span class="n">position_result</span> <span class="o">=</span> <span class="n">collect_filtered_positions</span><span class="p">(</span><span class="n">filtered_vcf</span><span class="p">)</span>
</span><span id="main-604"><a href="#main-604"><span class="linenos">604</span></a>    <span class="k">match</span> <span class="n">position_result</span><span class="p">:</span>
</span><span id="main-605"><a href="#main-605"><span class="linenos">605</span></a>        <span class="k">case</span> <span class="n">Ok</span><span class="p">(</span><span class="n">positions</span><span class="p">):</span>
</span><span id="main-606"><a href="#main-606"><span class="linenos">606</span></a>            <span class="k">pass</span>
</span><span id="main-607"><a href="#main-607"><span class="linenos">607</span></a>        <span class="k">case</span> <span class="n">Err</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
</span><span id="main-608"><a href="#main-608"><span class="linenos">608</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="main-609"><a href="#main-609"><span class="linenos">609</span></a>
</span><span id="main-610"><a href="#main-610"><span class="linenos">610</span></a>    <span class="c1"># lazily read the CADD Score table and filter its rows to only those</span>
</span><span id="main-611"><a href="#main-611"><span class="linenos">611</span></a>    <span class="c1"># that contain a mutation that is present in the newly filtered VCF</span>
</span><span id="main-612"><a href="#main-612"><span class="linenos">612</span></a>    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
</span><span id="main-613"><a href="#main-613"><span class="linenos">613</span></a>        <span class="n">ic</span><span class="p">()</span>
</span><span id="main-614"><a href="#main-614"><span class="linenos">614</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="main-615"><a href="#main-615"><span class="linenos">615</span></a>            <span class="n">inspect</span><span class="o">.</span><span class="n">cleandoc</span><span class="p">(</span>
</span><span id="main-616"><a href="#main-616"><span class="linenos">616</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="main-617"><a href="#main-617"><span class="linenos">617</span></a><span class="sd">                Read the table of CADD scores provided at the table path below, double check</span>
</span><span id="main-618"><a href="#main-618"><span class="linenos">618</span></a><span class="sd">                that the expected column names are present, and then filter down to the positions</span>
</span><span id="main-619"><a href="#main-619"><span class="linenos">619</span></a><span class="sd">                that remain in the filtered VCF. This will ensure that no variants will remain in</span>
</span><span id="main-620"><a href="#main-620"><span class="linenos">620</span></a><span class="sd">                the CADD Score table that are not present in one of the animals in the filtered VCF.</span>
</span><span id="main-621"><a href="#main-621"><span class="linenos">621</span></a><span class="sd">                &quot;&quot;&quot;</span>
</span><span id="main-622"><a href="#main-622"><span class="linenos">622</span></a>            <span class="p">)</span>
</span><span id="main-623"><a href="#main-623"><span class="linenos">623</span></a>        <span class="p">)</span>
</span><span id="main-624"><a href="#main-624"><span class="linenos">624</span></a>        <span class="n">ic</span><span class="p">(</span><span class="n">table_path</span><span class="p">)</span>
</span><span id="main-625"><a href="#main-625"><span class="linenos">625</span></a>    <span class="n">cadd_score_df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
</span><span id="main-626"><a href="#main-626"><span class="linenos">626</span></a>        <span class="n">table_path</span><span class="p">,</span>
</span><span id="main-627"><a href="#main-627"><span class="linenos">627</span></a>        <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="main-628"><a href="#main-628"><span class="linenos">628</span></a>        <span class="n">skip_rows</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">skip</span><span class="p">,</span>
</span><span id="main-629"><a href="#main-629"><span class="linenos">629</span></a>        <span class="n">null_values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NA&quot;</span><span class="p">],</span>
</span><span id="main-630"><a href="#main-630"><span class="linenos">630</span></a>        <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="main-631"><a href="#main-631"><span class="linenos">631</span></a>    <span class="p">)</span>
</span><span id="main-632"><a href="#main-632"><span class="linenos">632</span></a>
</span><span id="main-633"><a href="#main-633"><span class="linenos">633</span></a>    <span class="k">assert</span> <span class="p">(</span>
</span><span id="main-634"><a href="#main-634"><span class="linenos">634</span></a>        <span class="n">params</span><span class="o">.</span><span class="n">pos</span> <span class="ow">in</span> <span class="n">cadd_score_df</span><span class="o">.</span><span class="n">columns</span>
</span><span id="main-635"><a href="#main-635"><span class="linenos">635</span></a>    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Position column named &#39;</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">pos</span><span class="si">}</span><span class="s2">&#39; is missing in CADD score file.&quot;</span>
</span><span id="main-636"><a href="#main-636"><span class="linenos">636</span></a>    <span class="k">assert</span> <span class="p">(</span>
</span><span id="main-637"><a href="#main-637"><span class="linenos">637</span></a>        <span class="n">params</span><span class="o">.</span><span class="n">chrom</span> <span class="ow">in</span> <span class="n">cadd_score_df</span><span class="o">.</span><span class="n">columns</span>
</span><span id="main-638"><a href="#main-638"><span class="linenos">638</span></a>    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Chromosome column named &#39;</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">chrom</span><span class="si">}</span><span class="s2">&#39; is missing in CADD score file.&quot;</span>
</span><span id="main-639"><a href="#main-639"><span class="linenos">639</span></a>
</span><span id="main-640"><a href="#main-640"><span class="linenos">640</span></a>    <span class="n">cadd_score_lazy</span> <span class="o">=</span> <span class="n">cadd_score_df</span><span class="o">.</span><span class="n">lazy</span><span class="p">()</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
</span><span id="main-641"><a href="#main-641"><span class="linenos">641</span></a>        <span class="n">pl</span><span class="o">.</span><span class="n">concat_str</span><span class="p">(</span>
</span><span id="main-642"><a href="#main-642"><span class="linenos">642</span></a>            <span class="p">[</span>
</span><span id="main-643"><a href="#main-643"><span class="linenos">643</span></a>                <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Chrom&quot;</span><span class="p">),</span>
</span><span id="main-644"><a href="#main-644"><span class="linenos">644</span></a>                <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;Pos&quot;</span><span class="p">),</span>
</span><span id="main-645"><a href="#main-645"><span class="linenos">645</span></a>            <span class="p">],</span>
</span><span id="main-646"><a href="#main-646"><span class="linenos">646</span></a>            <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
</span><span id="main-647"><a href="#main-647"><span class="linenos">647</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;Full Position&quot;</span><span class="p">),</span>
</span><span id="main-648"><a href="#main-648"><span class="linenos">648</span></a>    <span class="p">)</span>
</span><span id="main-649"><a href="#main-649"><span class="linenos">649</span></a>    <span class="n">positions</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cadd_score_lazy</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;Full Position&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
</span><span id="main-650"><a href="#main-650"><span class="linenos">650</span></a>        <span class="n">pl</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="s2">&quot;Full Position&quot;</span><span class="p">)</span>
</span><span id="main-651"><a href="#main-651"><span class="linenos">651</span></a>    <span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="o">~</span><span class="n">pl</span><span class="o">.</span><span class="n">all_horizontal</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">is_null</span><span class="p">()))</span><span class="o">.</span><span class="n">sink_csv</span><span class="p">(</span>
</span><span id="main-652"><a href="#main-652"><span class="linenos">652</span></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">_filtered_cadd_scores.tsv&quot;</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span>
</span><span id="main-653"><a href="#main-653"><span class="linenos">653</span></a>    <span class="p">)</span>
</span><span id="main-654"><a href="#main-654"><span class="linenos">654</span></a>
</span><span id="main-655"><a href="#main-655"><span class="linenos">655</span></a>    <span class="k">if</span> <span class="n">verbosity</span><span class="p">:</span>
</span><span id="main-656"><a href="#main-656"><span class="linenos">656</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering complete!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Main handles I/O, coordinates the flow of data through the above functions,
and exposes any errors.</p>
</div>


                </section>
    </main>
</body>
</html>